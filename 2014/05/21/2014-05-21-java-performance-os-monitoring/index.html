<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Java Performance - OS Monitoring | BobbyTang Tech Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Bottom Up Approach
Bottom up begins at the lowest level of the software stack, at the CPU level looking at statistics such as CPU cache misses, inefficient use of CPU instructions, and then working up">
<meta property="og:type" content="article">
<meta property="og:title" content="Java Performance - OS Monitoring">
<meta property="og:url" content="http://sicongtang.github.io/2014/05/21/2014-05-21-java-performance-os-monitoring/">
<meta property="og:site_name" content="BobbyTang Tech Blog">
<meta property="og:description" content="Bottom Up Approach
Bottom up begins at the lowest level of the software stack, at the CPU level looking at statistics such as CPU cache misses, inefficient use of CPU instructions, and then working up">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Java Performance - OS Monitoring">
<meta name="twitter:description" content="Bottom Up Approach
Bottom up begins at the lowest level of the software stack, at the CPU level looking at statistics such as CPU cache misses, inefficient use of CPU instructions, and then working up">

  
    <link rel="alternative" href="/atom.xml" title="BobbyTang Tech Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">

  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">BobbyTang Tech Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Learn Share Inspire</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="submit" value="&#xF002;" class="search-form-submit"><input type="hidden" name="q" value="site:http://sicongtang.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-2014-05-21-java-performance-os-monitoring" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/21/2014-05-21-java-performance-os-monitoring/" class="article-date">
  <time datetime="2014-05-20T16:16:37.000Z" itemprop="datePublished">May 21 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/books/">books</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Java Performance - OS Monitoring
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Bottom_Up_Approach">Bottom Up Approach</h2>
<p>Bottom up begins at the lowest level of the software stack, at the CPU level looking at statistics such as CPU cache misses, inefficient use of CPU instructions, and then working up the software stack at what constructs or idioms are used by the application.</p>
<h2 id="Choosing_the_Right_CPU_Architecture">Choosing the Right CPU Architecture</h2>
<p>One of the major design points behind the SPARC T-series processors is to address CPU cache misses by introducing multiple hardware threads per core.</p>
<h2 id="CPU_Utilization">CPU Utilization</h2>
<p>A system with a single CPU socket with a quad core processor with hyperthreading disabled will show four CPUs in the GNOME System Monitor and report four virtual processors using the Java API Runtime.availableProcessors(). </p>
<pre><code><span class="title">xosview</span>
vmstat
mpstat
top 
</code></pre><p>Which java thread is consuming CPU?</p>
<pre><code>jstack
</code></pre><h2 id="Monitoring_Linux_CPU_Scheduler_Run_Queue">Monitoring Linux CPU Scheduler Run Queue</h2>
<pre><code>vmstat
</code></pre><h2 id="Memory_Utilization">Memory Utilization</h2>
<pre><code>top
/<span class="keyword">proc</span>/meminf
</code></pre><p>However, the following vmstat output from a Linux system illustrates a system that is experiencing swapping.  P36</p>
<h2 id="Monitoring_Lock_Contention_on_Linux">Monitoring Lock Contention on Linux</h2>
<pre><code>pidstat -w -<span class="keyword">I</span> -p <span class="number">9391</span> <span class="number">5</span>
</code></pre><p>Hence, 3500 divided by 2, the num- ber of virtual processors = 1750. 1750 * 80,000 = 140,000,000. The number of clock cycles in 1 second on a 3.0GHz processor is 3,000,000,000. Thus, the percentage of clock cycles wasted on context switches is 140,000,000/3,000,000,000 = 4.7%. </p>
<p>The cost of a voluntary context switch at a processor clock cycle level is an expensive operation, generally upwards of about 80,000 clock cycles. </p>
<p>Again applying the general guideline of 3% to 5% of clock cycles spent in voluntary context switches implies a Java application that may be suffering from lock contention. </p>
<h2 id="Quick_Lock_Contention_Monitoring">Quick Lock Contention Monitoring</h2>
<h2 id="Isolating_Hot_Locks">Isolating Hot Locks</h2>
<p>A common practice to find contended locks in a Java application has been to periodically take thread dumps and look for threads that tend to be blocked on the same lock across several thread dumps.  </p>
<h2 id="Monitoring_Involuntary_Context_Switches">Monitoring Involuntary Context Switches</h2>
<p>In contrast to voluntary context switching where an executing thread voluntarily takes itself off the CPU, involun- tary thread context switches occur when a thread is taken off the CPU as a result of an expiring time quantum or has been preempted by a higher priority thread. </p>
<p>Involuntary context switches can also be monitored on Linux using <code>pidstat -w</code>. High involuntary context switches are an indication there are more threads ready to run than there are virtual processors available to run them. As a result it is common to observe a high run queue depth in vmstat, high CPU utilization, and a high number of migrations (migrations are the next topic in this section) in conjunction with a large number of involuntary context switches.</p>
<p>On Linux, creation of processor sets and assigning applications to those processor sets can be accomplished using the Linux <code>taskset</code> command.</p>
<h2 id="Monitoring_Thread_Migrations">Monitoring Thread Migrations</h2>
<p>As a general guideline, Java applications scaling across multiple cores or virtual processors and observing migrations greater than 500 per second could benefit from binding Java applications to processor sets.  </p>
<h2 id="Network_I/O_Utilization">Network I/O Utilization</h2>
<pre><code><span class="title">netstat</span> -i 
nicstat
</code></pre><h2 id="Disk_I/O_Utilization">Disk I/O Utilization</h2>
<pre><code>iostat -<span class="keyword">xm</span>
</code></pre><p>One of the challenges with monitoring disk I/O utilization is identifying which files are being read or written to and which application is the source of the disk activity.</p>
<p>At the application level any strategy to minimize disk activity will help such as reducing the number of read and write operations using buffered input and output streams or integrating a caching data structure into the application to reduce or eliminate disk interaction.</p>
<h2 id="Additional_Command_Line_Tools">Additional Command Line Tools</h2>
<pre><code><span class="keyword">sar</span>
</code></pre><h2 id="Monitoring_CPU_Utilization_on_SPARC_T-Series_Systems">Monitoring CPU Utilization on SPARC T-Series Systems</h2>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://sicongtang.github.io/2014/05/21/2014-05-21-java-performance-os-monitoring/" data-id="3qr7op5aa7v8498o" class="article-share-link">Share</a>
      
        <a href="http://sicongtang.github.io/2014/05/21/2014-05-21-java-performance-os-monitoring/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2014/05/30/2014-05-30-install-ruby-and-vim-command-without-root/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Install Ruby&amp;amp;Vim Command without Root
        
      </div>
    </a>
  
  
    <a href="/2014/04/29/2014-04-29-python-environment-setup/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Python Environment Setup</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/books/">books</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/devenvsetup-emacs/">devenvsetup emacs</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/devenvsetup-python/">devenvsetup python</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/devenvsetup-ruby/">devenvsetup ruby</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/javascript/">javascript</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/sql/">sql</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/test/">test</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/05/">May 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">April 2014</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/03/">March 2014</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/01/">January 2014</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2014/10/02/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2014/09/05/2014-09-05-javascript-patterns-notes/">Javascript Patterns Notes</a>
          </li>
        
          <li>
            <a href="/2014/09/02/2014-09-02-mongodb-sql-summary/">mongodb sql summary</a>
          </li>
        
          <li>
            <a href="/2014/07/24/2014-07-24-a-series-of-general-questions-while-designing-webapps/">A series of general questions while designing webapps</a>
          </li>
        
          <li>
            <a href="/2014/07/23/2014-07-23-getting-start-with-emacs/">Getting Start with Emacs</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2014 Bobby Tang<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'bobbytang';
  
  var disqus_url = 'http://sicongtang.github.io/2014/05/21/2014-05-21-java-performance-os-monitoring/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">

  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>



<script src="/js/script.js" type="text/javascript"></script>


  </div>
</body>
</html>