<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>BobbyTang Tech Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="BobbyTang Tech Blog">
<meta property="og:url" content="http://sicongtang.github.io/">
<meta property="og:site_name" content="BobbyTang Tech Blog">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="BobbyTang Tech Blog">
<meta name="twitter:description">

  
    <link rel="alternative" href="/atom.xml" title="BobbyTang Tech Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link href="http://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.min.css" type="text/css">

  <link rel="stylesheet" href="/css/bootstrap.min.css" type="text/css">

  <link rel="stylesheet" href="/css/style.css" type="text/css">

  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">BobbyTang Tech Blog</a>
    <div class="collapse navbar-collapse nav-menu">
      <ul class="nav navbar-nav">
      
        <li>
          <a href="/archives">
            <i class="fa fa-archive"></i>
            Archives
          </a>
        </li>
      
        <li>
          <a href="/categories">
            <i class="fa fa-folder"></i>
            Categories
          </a>
        </li>
      
        <li>
          <a href="/tags">
            <i class="fa fa-tags"></i>
            Tags
          </a>
        </li>
      
        <li>
          <a href="/wiki">
            <i class="fa fa-book"></i>
            Wiki
          </a>
        </li>
      
        <li>
          <a href="/about">
            <i class="fa fa-user"></i>
            About
          </a>
        </li>
      
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
          <li><a id="rss-link" href="/atom.xml" title="RSS Feed"><i class="fa fa-rss"></i></a></li>
        
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>

      <div id='content' class="container">

        <div class="page-header-wrapper">
          <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
          <div class="page-header">
            <h1 class="title">
          
            BobbyTang Tech Blog <small>Learn Share Inspire</small>
          
            </h1>
        </div>
      </div>
      
      <section id="main"
        
      >
  
    <article id="post-l555e0klrygz0a5w" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    

    
      <header class="article-header">
        <i class="fa fa-file-text-o"></i>
        
  
    <h1 class="archive-title" itemprop="name">
      <a class="article-title" href="/2014/09/05/2014-09-05-javascript-patterns-notes/">Javascript Patterns Notes</a>
    </h1>
  


        <div class="article-date">
  <time datetime="2014-09-05T09:20:45.000Z" itemprop="datePublished">Sep 5 2014</time>
</div>

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
          <p>This post aims to summarize the js patterns in Javascript Patterns book written by Stoyan-Stefanov. The category order is followed by the chapter of this book.</p>
<h2 id="1-essentials">1 Essentials</h2><h4 id="1.1-single-var-pattern">1.1 Single var Pattern</h4><script src="https://gist.github.com/85d9fea488160c21d1a7.js?file=single_var_pattern.js"></script>

<h4 id="1.2-switch-pattern">1.2 Switch Pattern</h4><script src="https://gist.github.com/85d9fea488160c21d1a7.js?file=switch_pattern.js"></script>

<h2 id="2-literal-patterns">2 Literal Patterns</h2><h4 id="2.1-patterns-for-enforcing-new">2.1 Patterns for Enforcing new</h4><p>If we forgot to add new, this.value will become global obejct.</p>
<script src="https://gist.github.com/85d9fea488160c21d1a7.js?file=patterns_for_enforcing_new.js"></script>

<h4 id="2.2-self-invoking-constructor">2.2 Self-Invoking Constructor</h4><script src="https://gist.github.com/85d9fea488160c21d1a7.js?file=self_invoking_constructor.js"></script>

<h4 id="2.3-error-objects">2.3 Error Objects</h4><p>On the other hand, throw works with any object, not necessarily an object created with one of the error constructors, so you can opt in for throwing your own objects.</p>
<script src="https://gist.github.com/85d9fea488160c21d1a7.js?file=error_objects.js"></script>

<h2 id="3-api-patterns">3 API Patterns</h2><h4 id="3.1-callback-pattern">3.1 Callback Pattern</h4><script src="https://gist.github.com/85d9fea488160c21d1a7.js?file=callback_pattern.js"></script>

<h4 id="3.2-configuration-object-pattern">3.2 Configuration Object Pattern</h4><p>The configuration object pattern is a way to provide cleaner APIs, especially if you’re building a library or any other code that will be consumed by other programs.</p>
<script src="https://gist.github.com/85d9fea488160c21d1a7.js?file=configuration_object_pattern.js"></script>

<h2 id="4-performance-patterns">4 Performance Patterns</h2><h4 id="4.1-self-defining-functions">4.1 Self-Defining Functions</h4><p>This pattern is useful when your function has some initial preparatory work to do and it needs to do it only once.</p>
<p>A drawback of the pattern is that any properties you’ve previously added to the original function will be lost when it redefines itself.</p>
<script src="https://gist.github.com/85d9fea488160c21d1a7.js?file=self_defining_functions.js"></script>

<h4 id="4.2-memoization-pattern(function-properties)">4.2 Memoization Pattern(Function Properties)</h4><p>You can add custom properties to your functions at any time. One use case for custom properties is to cache the results (the return value) of a function, so the next time the function is called, it doesn’t have to redo potentially heavy computations. Caching the results of a function is also known as memoization.</p>
<script src="https://gist.github.com/85d9fea488160c21d1a7.js?file=memoization_pattern.js"></script>

<h2 id="5-object-creation-patterns">5 Object Creation Patterns</h2><h4 id="5.1-prototypes-and-privacy">5.1 Prototypes and Privacy</h4><script src="https://gist.github.com/85d9fea488160c21d1a7.js?file=prototypes_and_privacy.js"></script>

<h4 id="5.2-evelation-pattern(revealing-module-pattern)">5.2 Evelation Pattern(revealing module pattern)</h4><h4 id="5.3-static-memebers">5.3 Static Memebers</h4><script src="https://gist.github.com/85d9fea488160c21d1a7.js?file=public_static_members.js"></script>

<script src="https://gist.github.com/85d9fea488160c21d1a7.js?file=private_static_members.js"></script>

<h2 id="6-code-reuse-patterns">6 Code Reuse Patterns</h2><h4 id="6.1-the-default-pattern">6.1 The Default Pattern</h4><h4 id="6.2-rent-a-constructor">6.2 Rent a Constructor</h4><h4 id="6.3-rent-and-set-prototype">6.3 Rent and Set Prototype</h4><script src="https://gist.github.com/85d9fea488160c21d1a7.js?file=rent_and_set_prototype.js"></script>

<h4 id="6.4-share-the-prototype">6.4 Share the Prototype</h4><script src="https://gist.github.com/85d9fea488160c21d1a7.js?file=share_the_prototype.js"></script>

<h4 id="6.5-a-temporary-constructor">6.5 A Temporary Constructor</h4><script src="https://gist.github.com/85d9fea488160c21d1a7.js?file=a_temporary_constructor.js"></script>

<h4 id="6.6-mix-ins">6.6 Mix-ins</h4><script src="https://gist.github.com/85d9fea488160c21d1a7.js?file=mixin_pattern.js"></script>


<h2 id="7-design-patterns">7 Design Patterns</h2><h2 id="references:">References:</h2><ol>
<li><a href="http://www.amazon.com/JavaScript-Patterns-Stoyan-Stefanov/dp/0596806752/ref=sr_1_1?ie=UTF8&amp;qid=1410247009&amp;sr=8-1" target="_blank" rel="external">Javascript Patterns</a></li>
</ol>

        
        <footer class="article-footer">
          <a data-url="http://sicongtang.github.io/2014/09/05/2014-09-05-javascript-patterns-notes/" data-id="l555e0klrygz0a5w" data_title="Javascript Patterns Notes"
          data_summary="This post aims to summarize the js patterns in Javascript Patterns book written by Stoyan-Stefanov. The category order is followed by the chapter of this book.
..." class="article-share-link">Share</a>
          
            <a href="http://sicongtang.github.io/2014/09/05/2014-09-05-javascript-patterns-notes/#disqus_thread" class="article-comment-link">Comments</a>
          
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript/">javascript</a>
  </div>


          

        </footer>
      
    </div>
  </div>
</article>


  
    <article id="post-8vns5u0avr388ij7" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    

    
      <header class="article-header">
        <i class="fa fa-file-text-o"></i>
        
  
    <h1 class="archive-title" itemprop="name">
      <a class="article-title" href="/2014/09/02/2014-09-02-mongodb-crud-summary/">Mongo Db Crud Summary</a>
    </h1>
  


        <div class="article-date">
  <time datetime="2014-09-02T05:41:21.000Z" itemprop="datePublished">Sep 2 2014</time>
</div>

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
          <figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">w, {Number/String, &gt; -<span class="number">1</span> || ‘majority’ || tag <span class="property">name</span>} <span class="keyword">the</span> <span class="command">write</span> concern <span class="keyword">for</span> <span class="keyword">the</span> operation <span class="keyword">where</span> &lt; <span class="number">1</span> <span class="keyword">is</span> no acknowlegement <span class="keyword">of</span> <span class="command">write</span> <span class="keyword">and</span> w &gt;= <span class="number">1</span>, w = ‘majority’ <span class="keyword">or</span> tag acknowledges <span class="keyword">the</span> <span class="command">write</span></div><div class="line">j, (Boolean, default:<span class="constant">false</span>) <span class="command">write</span> waits <span class="keyword">for</span> journal sync <span class="keyword">before</span> <span class="keyword">returning</span></div></pre></td></tr></table></figure>

<h2 id="system-admin">system admin</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">mongod --fork --logpath /root/mongodb/log/mongodb.log</div><div class="line">mongod —shutdown</div><div class="line">mongo hostname:port/dbschema -u username -p password</div><div class="line"></div><div class="line">db.serverStatus()</div><div class="line">db.serverStatus().connections</div></pre></td></tr></table></figure>

<h2 id="insert">insert</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">db.foo.insert({<span class="string">"bar"</span> : <span class="string">"baz"</span>})</div><div class="line">db.foo.batchInsert([{<span class="string">"_id"</span> : <span class="number">0</span>}, {<span class="string">"_id"</span> : <span class="number">1</span>}, {<span class="string">"_id"</span> : <span class="number">2</span>}])</div><div class="line"></div><div class="line"><span class="built_in">Object</span>.bsonsize(doc)</div></pre></td></tr></table></figure>

<h2 id="delete">delete</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">//like detele from, high time cost</span></div><div class="line">db.foo.remove({})</div><div class="line">db.users.remove({status: <span class="string">"D"</span>})</div><div class="line"><span class="comment">//like truncate</span></div><div class="line">db.tester.drop()</div></pre></td></tr></table></figure>

<h2 id="update">update</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">db.people.update({<span class="string">"_id"</span> : ObjectId(<span class="string">"4b2b9f67a1f631733d917a7c"</span>)}, joe)</div><div class="line"></div><div class="line">db.users.update({<span class="string">"name"</span> : <span class="string">"joe"</span>}, {<span class="string">"$set"</span> : {<span class="string">"favorite book"</span> : [<span class="string">"Cat's Cradle"</span>, <span class="string">"Foundation Trilogy"</span>, <span class="string">"Ender's Game"</span>]}})</div><div class="line">db.blog.posts.update({<span class="string">"author.name"</span> : <span class="string">"joe"</span>}, {<span class="string">"$set"</span> : {<span class="string">"author.name"</span> : <span class="string">"joe schmoe"</span>}})</div><div class="line">db.users.update({<span class="string">"name"</span> : <span class="string">"joe"</span>}, {<span class="string">"$unset"</span> : {<span class="string">"favorite book"</span> : <span class="number">1</span>}})</div><div class="line"></div><div class="line"></div><div class="line">db.blog.update({<span class="string">"post"</span> : post_id}, {<span class="string">"$inc"</span> : {<span class="string">"comments.0.votes"</span> : <span class="number">1</span>}})</div><div class="line"><span class="comment">//mongodb cannot update multiple array elements in single update operation</span></div><div class="line">db.blog.update({<span class="string">"comments.author"</span> : <span class="string">"John"</span>}, {<span class="string">"$set"</span> : {<span class="string">"comments.$.author"</span> : <span class="string">"Jim"</span>}})</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//full-document replacement, replacing the matched document with {"foo" : "bar"} </span></div><div class="line">db.coll.update(criteria, {<span class="string">"foo"</span> : <span class="string">"bar"</span>})</div><div class="line"></div><div class="line">db.users.update({<span class="string">"_id"</span> : ObjectId(<span class="string">"4b2d75476cc613d5ee930164"</span>)},</div><div class="line">                      {<span class="string">"$addToSet"</span> : {<span class="string">"emails"</span> : {<span class="string">"$each"</span> : [<span class="string">"joe@php.net"</span>, <span class="string">"joe@example.com"</span>, <span class="string">"joe@python.org"</span>]}}})</div><div class="line"></div><div class="line">db.movies.find({<span class="string">"genre"</span> : <span class="string">"horror"</span>}, </div><div class="line">     {<span class="string">"$push"</span> : {<span class="string">"top10"</span> : {</div><div class="line">          <span class="string">"$each"</span> : [{<span class="string">"name"</span> : <span class="string">"Nightmare on Elm Street"</span>, <span class="string">"rating"</span> : <span class="number">6.6</span>}, {<span class="string">"name"</span> : <span class="string">"Saw"</span>, <span class="string">"rating"</span> : <span class="number">4.3</span>}],</div><div class="line">          <span class="string">"$slice"</span> : -<span class="number">10</span>,</div><div class="line">          <span class="string">"$sort"</span> : {<span class="string">"rating"</span> : -<span class="number">1</span>}}}})</div><div class="line"></div><div class="line">{<span class="string">"$pop"</span>: {<span class="string">"key"</span>: <span class="number">1</span>}}</div><div class="line">{<span class="string">"$pop"</span>: {<span class="string">"key"</span>: -<span class="number">1</span>}}</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//remove all the matching documents</span></div><div class="line">db.lists.update({}, {<span class="string">"$pull"</span> : {<span class="string">"todo"</span> : <span class="string">"laundry"</span>}})</div><div class="line"></div><div class="line"><span class="comment">//positional array modification</span></div><div class="line">db.blog.update({<span class="string">"post"</span> : post_id}, {<span class="string">"$inc"</span> : {<span class="string">"comments.0.votes"</span> : <span class="number">1</span>}})</div><div class="line">db.blog.update({<span class="string">"comments.author"</span> : <span class="string">"John"</span>}, {<span class="string">"$set"</span> : {<span class="string">"comments.$.author"</span> : <span class="string">"Jim"</span>}})</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//upserts</span></div><div class="line"><span class="comment">//eliminate the race condition and faster and atomic</span></div><div class="line"></div><div class="line"><span class="comment">//If no document is found that matches the update criteria, a new document will be created by combining the criteria and updated documents.</span></div><div class="line">db.analytics.update({<span class="string">"url"</span> : <span class="string">"/blog"</span>}, {<span class="string">"$inc"</span> : {<span class="string">"pageviews"</span> : <span class="number">1</span>}}, <span class="literal">true</span>)</div><div class="line"><span class="comment">//If we run this update again, it will match the existing document, nothing will be inserted, and so the "createdAt" field will not be changed.</span></div><div class="line">db.users.update({}, {<span class="string">"$setOnInsert"</span> : {<span class="string">"createdAt"</span> : <span class="keyword">new</span> <span class="built_in">Date</span>()}}, <span class="literal">true</span>)</div><div class="line">db.foo.save(x)</div><div class="line">db.foo.update({<span class="string">"_id"</span>: x._id}, x)</div><div class="line"></div><div class="line"><span class="comment">//updating multiple documents</span></div><div class="line"></div><div class="line">db.count.update({x : <span class="number">1</span>}, {$inc : {x : <span class="number">1</span>}}, <span class="literal">false</span>, <span class="literal">true</span>) </div><div class="line">db.runCommand({getLastError : <span class="number">1</span>})</div><div class="line">{</div><div class="line"><span class="string">"err"</span> : <span class="literal">null</span>,</div><div class="line"><span class="string">"updatedExisting"</span> : <span class="literal">true</span>, </div><div class="line"><span class="string">"n"</span> : <span class="number">5</span>,</div><div class="line"><span class="string">"ok"</span> : <span class="literal">true</span></div><div class="line">}</div></pre></td></tr></table></figure>

<h2 id="select">select</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">//</span></div><div class="line">db.users.find()</div><div class="line"><span class="comment">//only display cols</span></div><div class="line">db.users.find({}, {<span class="string">"username"</span> : <span class="number">1</span>)</div><div class="line"><span class="comment">//only display cols without _id</span></div><div class="line">db.users.find({}, {<span class="string">"username"</span> : <span class="number">1</span>, <span class="string">"_id"</span> : <span class="number">0</span>})</div><div class="line"></div><div class="line"><span class="comment">//count</span></div><div class="line">db.users.count()</div><div class="line"></div><div class="line"><span class="comment">//conditionals are an inner document key, and modifiers are always a key in the outer document.</span></div><div class="line"><span class="comment">//There are a few “meta-operators” that go in the outer document: "$and“, "$or“, and "$not“.</span></div><div class="line">db.users.find({<span class="string">"id_num"</span> : {<span class="string">"$not"</span> : {<span class="string">"$mod"</span> : [<span class="number">5</span>, <span class="number">1</span>]}}})</div><div class="line"></div><div class="line">db.users.find({<span class="string">"x"</span> : {<span class="string">"$lt"</span> : <span class="number">1</span>, <span class="string">"$in"</span> : [<span class="number">4</span>]}})</div><div class="line"></div><div class="line"><span class="comment">// will return all the docs</span></div><div class="line">db.c.find({<span class="string">"z"</span>:<span class="literal">null</span>})</div><div class="line"><span class="comment">// only display null value, please use this</span></div><div class="line">db.c.find({<span class="string">"z"</span> : {<span class="string">"$in"</span> : [<span class="literal">null</span>], <span class="string">"$exists"</span> : <span class="literal">true</span>}})</div><div class="line"></div><div class="line"><span class="comment">//indexes cannot be used for case-insensitive searches</span></div><div class="line">db.users.find({<span class="string">"name"</span> : <span class="regexp">/joe/i</span>})</div><div class="line">db.users.find({<span class="string">"name"</span> : <span class="regexp">/joey?/i</span>})</div><div class="line"></div><div class="line"><span class="comment">//querying array</span></div><div class="line">db.food.find({fruit : {$all : [<span class="string">"apple"</span>, <span class="string">"banana"</span>]}})</div><div class="line">db.food.find({<span class="string">"fruit"</span> : {<span class="string">"$size"</span> : <span class="number">3</span>}})</div><div class="line">db.blog.posts.findOne(criteria, {<span class="string">"comments"</span> : {<span class="string">"$slice"</span> : [<span class="number">23</span>, <span class="number">10</span>]}})</div><div class="line">db.blog.posts.find({<span class="string">"comments.name"</span> : <span class="string">"bob"</span>}, {<span class="string">"comments.$"</span> : <span class="number">1</span>})</div><div class="line"></div><div class="line"><span class="comment">//$where</span></div><div class="line"></div><div class="line"><span class="comment">//pagination</span></div><div class="line">db.stock.find({<span class="string">"desc"</span> : <span class="string">"mp3"</span>}).limit(<span class="number">50</span>).skip(<span class="number">50</span>).sort({<span class="string">"price"</span> : -<span class="number">1</span>})</div><div class="line"></div><div class="line"><span class="comment">//find a random document</span></div><div class="line"><span class="keyword">var</span> random = <span class="built_in">Math</span>.random()</div><div class="line">result = db.foo.findOne({<span class="string">"random"</span> : {<span class="string">"$gt"</span> : random}}) </div><div class="line"><span class="keyword">if</span> (result == <span class="literal">null</span>) {</div><div class="line">  result = db.foo.findOne({<span class="string">"random"</span> : {<span class="string">"$lt"</span> : random}}) </div><div class="line">} </div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//cursor</span></div><div class="line">cursor = db.foo.find();</div><div class="line"><span class="keyword">while</span> (cursor.hasNext()) {</div><div class="line">  <span class="keyword">var</span> doc = cursor.next();</div><div class="line">  doc = process(doc);</div><div class="line">  db.foo.save(doc);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//command</span></div><div class="line">use temp</div><div class="line">db.runCommand({shutdown:<span class="number">1</span>})</div><div class="line">db.adminCommand({<span class="string">"shutdown"</span> : <span class="number">1</span>}) </div></pre></td></tr></table></figure>

<h2 id="aggregration">aggregration</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">//calculate commission</span></div><div class="line">db.orders.aggregate([{</div><div class="line">  $match: filter</div><div class="line">}, {</div><div class="line">  $unwind: <span class="string">"$stores"</span></div><div class="line">}, {</div><div class="line">  $group: {</div><div class="line">    _id: {</div><div class="line">      store_id: <span class="string">"$stores.store_id"</span>,</div><div class="line">      store_name: <span class="string">"$stores.store_name"</span></div><div class="line">    },</div><div class="line">    total_commission: {</div><div class="line">      $sum: <span class="string">"$stores.commission"</span></div><div class="line">    }</div><div class="line">  }</div><div class="line">}, {</div><div class="line">  $sort: {</div><div class="line">    <span class="string">"_id.store_id"</span>: <span class="number">1</span></div><div class="line">  }</div><div class="line">}, {</div><div class="line">  $skip: <span class="number">0</span></div><div class="line">}, {</div><div class="line">  $limit: <span class="number">25</span></div><div class="line">}]);</div><div class="line"></div><div class="line"><span class="comment">//calculate count of commission</span></div><div class="line">db.orders.aggregate([{</div><div class="line">  $match: filter</div><div class="line">}, {</div><div class="line">  $unwind: <span class="string">"$stores"</span></div><div class="line">}, {</div><div class="line">  $group: {</div><div class="line">    _id: {</div><div class="line">      store_id: <span class="string">"$stores.store_id"</span>,</div><div class="line">      store_name: <span class="string">"$stores.store_name"</span></div><div class="line">    },</div><div class="line">    total_commission: {</div><div class="line">      $sum: <span class="string">"$stores.commission"</span></div><div class="line">    }</div><div class="line">  }</div><div class="line">}, {</div><div class="line">  $group: {</div><div class="line">    _id: <span class="literal">null</span>,</div><div class="line">    count: {</div><div class="line">      $sum: <span class="number">1</span></div><div class="line">    }</div><div class="line">  }</div><div class="line">}]);</div></pre></td></tr></table></figure>

        
        <footer class="article-footer">
          <a data-url="http://sicongtang.github.io/2014/09/02/2014-09-02-mongodb-crud-summary/" data-id="8vns5u0avr388ij7" data_title="Mongo Db Crud Summary"
          data_summary="12w, {Number/String, &gt; -1 || ‘majority’ || tag name} the write concern for the operation where &lt; 1 is no acknowlegement of write and w &gt;= 1, w = ‘ma..." class="article-share-link">Share</a>
          
            <a href="http://sicongtang.github.io/2014/09/02/2014-09-02-mongodb-crud-summary/#disqus_thread" class="article-comment-link">Comments</a>
          
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/sql/">sql</a>
  </div>


          

        </footer>
      
    </div>
  </div>
</article>


  
    <article id="post-3jufiqk2cbhtmvxa" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    

    
      <header class="article-header">
        <i class="fa fa-file-text-o"></i>
        
  
    <h1 class="archive-title" itemprop="name">
      <a class="article-title" href="/2014/07/24/2014-07-24-a-series-of-general-questions-while-designing-webapps/">a Series of General Questions While Designing Webapps</a>
    </h1>
  


        <div class="article-date">
  <time datetime="2014-07-24T07:36:16.000Z" itemprop="datePublished">Jul 24 2014</time>
</div>

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
          <p>In this post, I am going to list a series of questions as well as answers in order to figure out why contemporary webapps are designed and built like that.</p>
<h4 id="why-single-page-applications?">Why single page applications?</h4><ul>
<li>The web is currently trending such that all data/content will be exposed through an API.<h4 id="why-backbonejs?">Why backbonejs?</h4></li>
<li>It is essentially MVC for the client and allows you to make your code modular.</li>
<li>Backbone.js is not strictly for single-age apps (SPA), but the strength of Backbone.js is in the SPA realm.</li>
<li>Basically, backbone works best to untangle elaborate chains of rendering logic and model updating. If you just need to select and manipulate DOM elements, it&#39;s overkill. jQuery alone can handle that.</li>
</ul>
<h4 id="why-amd(requirejs)?">Why AMD(RequireJS)?</h4><p>Without RequreJS</p>
<ul>
<li>Browsers are limited in how many parallel requests they can make, so it can only do a certain number at a time.</li>
<li>Scripts loaded synchronously. This means that the browser cannot continue page rendering while the script is loading.</li>
</ul>
<p>With RequireJS</p>
<ul>
<li>Loading the scripts asynchronously.</li>
<li>Ensuring that modules with dependencies are loaded in the right order. </li>
<li>You can use the optimizer to combine the JavaScript files together and minify it.<h4 id="which-is-preferred-about-i18n?-client-side-or-server-side?">Which is preferred about i18n? Client side or server side?</h4></li>
</ul>

        
        <footer class="article-footer">
          <a data-url="http://sicongtang.github.io/2014/07/24/2014-07-24-a-series-of-general-questions-while-designing-webapps/" data-id="3jufiqk2cbhtmvxa" data_title="a Series of General Questions While Designing Webapps"
          data_summary="In this post, I am going to list a series of questions as well as answers in order to figure out why contemporary webapps are designed and built like that.
Why ..." class="article-share-link">Share</a>
          
            <a href="http://sicongtang.github.io/2014/07/24/2014-07-24-a-series-of-general-questions-while-designing-webapps/#disqus_thread" class="article-comment-link">Comments</a>
          
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/web/">web</a>
  </div>


          

        </footer>
      
    </div>
  </div>
</article>


  
    <article id="post-5lyfhdp25h92vkcl" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    

    
      <header class="article-header">
        <i class="fa fa-file-text-o"></i>
        
  
    <h1 class="archive-title" itemprop="name">
      <a class="article-title" href="/2014/07/23/2014-07-23-getting-start-with-emacs/">Getting Start With Emacs</a>
    </h1>
  


        <div class="article-date">
  <time datetime="2014-07-23T02:10:11.000Z" itemprop="datePublished">Jul 23 2014</time>
</div>

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
          <h2 id="why-emacs?">Why emacs?</h2><p>Previously I was developing with dynamic language, like js, ruby, python, via using vim. Vim is a great editing tools with different internal mode(command/visial/insert mode). But the original reason why I intended to migrate from vim to emacs is the powerful <code>REPL</code> environment as well as other embedded function.</p>
<h2 id="trouble-from-vim-to-emacs">Trouble from vim to emacs</h2><p>I was starting to read the documentation of emacs, and acquainted with new key-binding. Then I realized editing in emacs is less effective than in vim. Thus I came up to <code>evil</code>, an extensible vi layer for Emacs. Combing emacs with evil will maximize the productivies, therefore it is not necessary for you to remember all the key-binding under emacs environment.</p>
<h2 id="how-to-install-on-os-x?">How to install on OS X?</h2><p>Download and install emacs, no args will not install gui enviornment.</p>
<p><code>brew install emacs</code></p>
<h2 id="keyboard-setting-on-os-x">Keyboard setting on OS X</h2><ol>
<li>open the terminal perference, and then set option as a meta key.</li>
<li>recommend you to swap capslock with ctrl</li>
</ol>
<h2 id="basic-command-you-should-remember">Basic command you should remember</h2><p>Emacs self key-binding</p>
<ul>
<li><code>M-x help-with-tutorial</code> open emacs tutorial</li>
<li><code>C-x C-c</code> quit</li>
<li><code>C-x C-f</code> open file</li>
<li><code>C-x C-s</code> save file</li>
<li><code>C-g</code> quit a partially entered command</li>
<li><p><code>C-h m</code> list active mode</p>
</li>
<li><p><code>C-x left-arrow</code> previous buffer</p>
</li>
<li><code>C-x C-b</code> list buffers</li>
<li><p><code>M-x desktop-clear</code></p>
</li>
<li><p><code>C-x 0</code> close current window</p>
</li>
<li><code>C-x 1</code> close other window except current</li>
<li><code>C-x 2</code> split window vertically</li>
<li><code>C-x 3</code> split window horizontally</li>
<li><p><code>C-x 4 C-f</code> open new window and move the cursor to it</p>
</li>
<li><p><code>C-v</code> scroll down the window</p>
</li>
<li><code>M-v</code> scroll up the window</li>
<li><p><code>C-M-v</code> scroll the botton window without focusing the cursor</p>
</li>
<li><p><code>M-;</code> comment on current line</p>
</li>
</ul>
<p>Plugin default setting key-binding</p>
<ul>
<li><code>tab</code> autocomplete in evil-insert mode</li>
<li><code>gv</code> reselect evil visual mode&quot;</li>
<li><code>:%s/foo/bar/g</code> replace all matched words in evil-normal mode</li>
<li><code>1g</code> or <code>ng</code> jump to the specific line</li>
<li><code>C-c b</code> send buffer to REPL</li>
<li><code>C-c r</code> send region to REPL</li>
<li><code>C-c f</code> format js/html/css by web-beautify</li>
</ul>
<h2 id="emacs-package-system">Emacs package system</h2><p>There are four package servers, including GUN, ELPA, Marmalade, MELPA. Currently I choosed MELPA as a default package system, becasue I forked config from <a href="https://github.com/purcell/emacs.d/" title="Title" target="_blank" rel="external">Steve Purcell emacs.d repository</a>.</p>
<p>There are several starter kits you can begin with:</p>
<ol>
<li><a href="https://github.com/eschulte/emacs24-starter-kit" target="_blank" rel="external">emacs24-starter-kit</a> is highly recommended if you want a clean environment and build it from scratch.</li>
<li><a href="https://github.com/bbatsov/prelude" target="_blank" rel="external">emacs prelude</a> is not recommended by novice.</li>
<li><a href="https://github.com/purcell/emacs.d" target="_blank" rel="external">Steve Purcell&#39;s emacs.d</a>.</li>
<li><a href="https://github.com/xiaohanyu/oh-my-emacs" target="_blank" rel="external">oh-my-emacs</a> adapted el-get instead of the builtin package.el.</li>
<li><a href="https://github.com/redguardtoo/emacs.d" target="_blank" rel="external">redguardtoo&#39;s emacs</a> is forked from Purcell&#39;s emacs.d, and make it localize if you have no access to network. In addition, it enhances some features on the top of Purcell&#39;s config.</li>
</ol>
<p>Steve Purcell emacs config is really impressive and the structure is clean and tidy. So I highly recommmend you to fork his repos and localize your configure file into your home directory.</p>
<p>Note that if you encounter any difficulties, please run command <code>emacs --debug-init</code> to check any error.</p>
<h2 id="increamtal-plugin-list-besides-purcell-config">Increamtal plugin list besides purcell config</h2><ol>
<li><a href="https://gitorious.org/evil/pages/Home" target="_blank" rel="external">evil</a> is an extensible vi layer for Emacs.</li>
<li><a href="https://github.com/emacs-helm/helm" target="_blank" rel="external">helm</a> is Emacs incremental and narrowing framework.</li>
<li><a href="https://github.com/yasuyk/ac-helm" target="_blank" rel="external">ac-helm</a> integrates AC in helm mode.</li>
<li><a href="https://github.com/capitaomorte/yasnippet" target="_blank" rel="external">yasnippet</a> is a template system for Emacs. The snippet syntax is inspired from TextMate&#39;s syntax.</li>
<li><a href="https://github.com/yasuyk/ac-helm" target="_blank" rel="external">ace-jump-mode</a> is A quick cursor location minor mode for emacs, like easymotion under vim.</li>
<li><a href="https://github.com/yasuyk/web-beautify" target="_blank" rel="external">web-beautify</a> is used to format HTML, CSS and JavaScript/JSON by js-beautify</li>
</ol>
<h2 id="other-notes">Other notes</h2><ol>
<li>Please <code>brew install ispell</code> before enabling flyspell</li>
<li>Using <code>node --interactive</code> as inferior-js-program-command in js-comint mode.</li>
<li>Please <code>(setq auto-save-default nil)</code> in order to disable auto-save-mode.</li>
<li>If you cannot download plugins, please <code>M-x package-list-packages</code> to refresh your package list<h2 id="reference">Reference</h2></li>
<li><a href="http://ergoemacs.org/misc/list_of_emacs_starter_kits.html" target="_blank" rel="external">http://ergoemacs.org/misc/list_of_emacs_starter_kits.html</a></li>
<li><a href="http://ergoemacs.org/emacs/emacs_package_system.html" target="_blank" rel="external">http://ergoemacs.org/emacs/emacs_package_system.html</a></li>
<li><a href="http://batsov.com/articles/2012/02/19/package-management-in-emacs-the-good-the-bad-and-the-ugly/" target="_blank" rel="external">http://batsov.com/articles/2012/02/19/package-management-in-emacs-the-good-the-bad-and-the-ugly/</a></li>
<li><a href="http://toumorokoshi.github.io/emacs-from-scratch-part-1-extending-emacs-basics.html" target="_blank" rel="external">http://toumorokoshi.github.io/emacs-from-scratch-part-1-extending-emacs-basics.html</a></li>
<li><a href="http://blog.csdn.net/redguardtoo/article/details/7222501" target="_blank" rel="external">http://blog.csdn.net/redguardtoo/article/details/7222501</a></li>
</ol>

        
        <footer class="article-footer">
          <a data-url="http://sicongtang.github.io/2014/07/23/2014-07-23-getting-start-with-emacs/" data-id="5lyfhdp25h92vkcl" data_title="Getting Start With Emacs"
          data_summary="Why emacs?Previously I was developing with dynamic language, like js, ruby, python, via using vim. Vim is a great editing tools with different internal mode(com..." class="article-share-link">Share</a>
          
            <a href="http://sicongtang.github.io/2014/07/23/2014-07-23-getting-start-with-emacs/#disqus_thread" class="article-comment-link">Comments</a>
          
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/devenvsetup-emacs/">devenvsetup emacs</a>
  </div>


          

        </footer>
      
    </div>
  </div>
</article>


  
    <article id="post-v0njb08ywbnmsv9p" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    

    
      <header class="article-header">
        <i class="fa fa-file-text-o"></i>
        
  
    <h1 class="archive-title" itemprop="name">
      <a class="article-title" href="/2014/07/16/2014-07-16-frontend-javascript-framework-alternatives/">Frontend Java Script Framework Alternatives</a>
    </h1>
  


        <div class="article-date">
  <time datetime="2014-07-16T09:37:35.000Z" itemprop="datePublished">Jul 16 2014</time>
</div>

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
          <h2 id="mv*-framework">MV* framework</h2><ol>
<li>BackBonejs</li>
<li>Angularjs</li>
<li>Emberjs</li>
<li>KnockoutJS</li>
<li>Dojo</li>
<li>Spinejs</li>
</ol>
<h2 id="mvc-extension-framework">MVC extension framework</h2><ol>
<li>MarionetteJS</li>
<li>Thorax</li>
</ol>
<h2 id="template">template</h2><ol>
<li>Handlebars</li>
<li>Mustache</li>
<li>JST</li>
<li>ECO</li>
</ol>
<h2 id="build-automation">build automation</h2><ol>
<li>Grunt</li>
</ol>
<h2 id="module-loader">module loader</h2><ol>
<li>Requirejs</li>
<li>Browserify</li>
</ol>
<h2 id="package-manager">package manager</h2><ol>
<li>Bower</li>
</ol>
<h2 id="workflow-automation">workflow automation</h2><ol>
<li>Yeoman</li>
<li>Brunch</li>
<li>Catero</li>
</ol>
<h2 id="code-analysis">code analysis</h2><ol>
<li>JSLint</li>
<li>JSHint</li>
</ol>
<h2 id="unit-testing">unit testing</h2><ol>
<li>Jasmine</li>
<li>QUnit</li>
<li>Mocha</li>
</ol>
<p>Reference: </p>
<ol>
<li><a href="http://todomvc.com/" target="_blank" rel="external">http://todomvc.com/</a></li>
</ol>

        
        <footer class="article-footer">
          <a data-url="http://sicongtang.github.io/2014/07/16/2014-07-16-frontend-javascript-framework-alternatives/" data-id="v0njb08ywbnmsv9p" data_title="Frontend Java Script Framework Alternatives"
          data_summary="MV* framework
BackBonejs
Angularjs
Emberjs
KnockoutJS
Dojo
Spinejs

MVC extension framework
MarionetteJS
Thorax

template
Handlebars
Mustache
JST
ECO

build aut..." class="article-share-link">Share</a>
          
            <a href="http://sicongtang.github.io/2014/07/16/2014-07-16-frontend-javascript-framework-alternatives/#disqus_thread" class="article-comment-link">Comments</a>
          
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript/">javascript</a>
  </div>


          

        </footer>
      
    </div>
  </div>
</article>


  
    <article id="post-iqnmvkdxpsv1cqed" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    

    
      <header class="article-header">
        <i class="fa fa-file-text-o"></i>
        
  
    <h1 class="archive-title" itemprop="name">
      <a class="article-title" href="/2014/05/30/2014-05-30-install-ruby-and-vim-command-without-root/">Install Ruby&amp;Amp;Vim Command Without Root</a>
    </h1>
  


        <div class="article-date">
  <time datetime="2014-05-30T00:17:24.000Z" itemprop="datePublished">May 30 2014</time>
</div>

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
          <p>This post intend to write down the step for installing ruby and vim command line tools, without root access.
In addition, ncurses is the prerequisities of installing ruby and vim. Also, please install ruby first in order to enable rubyinterp.</p>
<ol>
<li>download ncurses</li>
<li><code>tar xvf ncurses-5.9.tar.gz</code></li>
<li>sh <code>./configure --prefix=/home/bobby/tools/ncurses ##--with-shared</code></li>
<li><code>make</code></li>
<li><code>make install</code></li>
<li>download ruby</li>
<li>sh <code>./configure --prefix=/home/bobby/tools/ruby1.9 --with-tlib=ncurses</code></li>
<li><code>make</code></li>
<li><code>make install</code></li>
<li>download from vim</li>
<li><code>bzip2 -cd vimxxx.tar.bz2 | tar xvf -</code></li>
<li>edit .bash_profile <code>set CPPLAGS=&quot;-I/home/bobby/tools/ncurses/include&quot; LDFLAGS=&quot;-L/home/bobby/tools/ncurses/lib&quot; export CPPFLAGS LDFLAGS</code></li>
<li>sh <code>./configure --prefix=/home/bobby/tools/vim7.4 --disable-selinux --enbale-gui=no --without-x --disable-gpm --disable-nls --with-tilib=ncurses --enable-multibyte --enable-rubyinterp --enable-perlinterp --enable-pythoninterp</code></li>
<li><code>make</code></li>
<li><code>make install</code></li>
<li>edit ~/.bashrc <code>alias vim=&quot;/home/bobby/tools/vim7.4/bin/vim&quot;</code></li>
<li>edit ~/.vimrc <code>set synatx on set nocompatible set backspace=2</code></li>
<li>setup vimruntime in order to let vim find the syntax env, please edit .bash_profile <code>export VIMRUNTIME=/home/bobby/tools/preinstall/vim74/runtime</code></li>
</ol>

        
        <footer class="article-footer">
          <a data-url="http://sicongtang.github.io/2014/05/30/2014-05-30-install-ruby-and-vim-command-without-root/" data-id="iqnmvkdxpsv1cqed" data_title="Install Ruby&Amp;Vim Command Without Root"
          data_summary="This post intend to write down the step for installing ruby and vim command line tools, without root access.
In addition, ncurses is the prerequisities of insta..." class="article-share-link">Share</a>
          
            <a href="http://sicongtang.github.io/2014/05/30/2014-05-30-install-ruby-and-vim-command-without-root/#disqus_thread" class="article-comment-link">Comments</a>
          
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/devenvsetup-ruby/">devenvsetup ruby</a>
  </div>


          

        </footer>
      
    </div>
  </div>
</article>


  
    <article id="post-8z4ga62kn9gffx6g" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    

    
      <header class="article-header">
        <i class="fa fa-file-text-o"></i>
        
  
    <h1 class="archive-title" itemprop="name">
      <a class="article-title" href="/2014/05/21/2014-05-21-java-performance-os-monitoring/">Java Performance   Os Monitoring</a>
    </h1>
  


        <div class="article-date">
  <time datetime="2014-05-20T16:16:37.000Z" itemprop="datePublished">May 21 2014</time>
</div>

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
          <h2 id="bottom-up-approach">Bottom Up Approach</h2><p>Bottom up begins at the lowest level of the software stack, at the CPU level looking at statistics such as CPU cache misses, inefficient use of CPU instructions, and then working up the software stack at what constructs or idioms are used by the application.</p>
<h2 id="choosing-the-right-cpu-architecture">Choosing the Right CPU Architecture</h2><p>One of the major design points behind the SPARC T-series processors is to address CPU cache misses by introducing multiple hardware threads per core.</p>
<h2 id="cpu-utilization">CPU Utilization</h2><p>A system with a single CPU socket with a quad core processor with hyperthreading disabled will show four CPUs in the GNOME System Monitor and report four virtual processors using the Java API Runtime.availableProcessors(). </p>
<pre><code>xosview
vmstat
mpstat
top 
</code></pre><p>Which java thread is consuming CPU?</p>
<pre><code>jstack
</code></pre><h2 id="monitoring-linux-cpu-scheduler-run-queue">Monitoring Linux CPU Scheduler Run Queue</h2><pre><code>vmstat
</code></pre><h2 id="memory-utilization">Memory Utilization</h2><pre><code>top
/proc/meminf
</code></pre><p>However, the following vmstat output from a Linux system illustrates a system that is experiencing swapping.  P36</p>
<h2 id="monitoring-lock-contention-on-linux">Monitoring Lock Contention on Linux</h2><pre><code>pidstat -w -I -p 9391 5
</code></pre><p>Hence, 3500 divided by 2, the num- ber of virtual processors = 1750. 1750 * 80,000 = 140,000,000. The number of clock cycles in 1 second on a 3.0GHz processor is 3,000,000,000. Thus, the percentage of clock cycles wasted on context switches is 140,000,000/3,000,000,000 = 4.7%. </p>
<p>The cost of a voluntary context switch at a processor clock cycle level is an expensive operation, generally upwards of about 80,000 clock cycles. </p>
<p>Again applying the general guideline of 3% to 5% of clock cycles spent in voluntary context switches implies a Java application that may be suffering from lock contention. </p>
<h2 id="quick-lock-contention-monitoring">Quick Lock Contention Monitoring</h2><h2 id="isolating-hot-locks">Isolating Hot Locks</h2><p>A common practice to find contended locks in a Java application has been to periodically take thread dumps and look for threads that tend to be blocked on the same lock across several thread dumps.  </p>
<h2 id="monitoring-involuntary-context-switches">Monitoring Involuntary Context Switches</h2><p>In contrast to voluntary context switching where an executing thread voluntarily takes itself off the CPU, involun- tary thread context switches occur when a thread is taken off the CPU as a result of an expiring time quantum or has been preempted by a higher priority thread. </p>
<p>Involuntary context switches can also be monitored on Linux using <code>pidstat -w</code>. High involuntary context switches are an indication there are more threads ready to run than there are virtual processors available to run them. As a result it is common to observe a high run queue depth in vmstat, high CPU utilization, and a high number of migrations (migrations are the next topic in this section) in conjunction with a large number of involuntary context switches.</p>
<p>On Linux, creation of processor sets and assigning applications to those processor sets can be accomplished using the Linux <code>taskset</code> command.</p>
<h2 id="monitoring-thread-migrations">Monitoring Thread Migrations</h2><p>As a general guideline, Java applications scaling across multiple cores or virtual processors and observing migrations greater than 500 per second could benefit from binding Java applications to processor sets.  </p>
<h2 id="network-i/o-utilization">Network I/O Utilization</h2><pre><code>netstat -i 
nicstat
</code></pre><h2 id="disk-i/o-utilization">Disk I/O Utilization</h2><pre><code>iostat -xm
</code></pre><p>One of the challenges with monitoring disk I/O utilization is identifying which files are being read or written to and which application is the source of the disk activity.</p>
<p>At the application level any strategy to minimize disk activity will help such as reducing the number of read and write operations using buffered input and output streams or integrating a caching data structure into the application to reduce or eliminate disk interaction.</p>
<h2 id="additional-command-line-tools">Additional Command Line Tools</h2><pre><code>sar
</code></pre><h2 id="monitoring-cpu-utilization-on-sparc-t-series-systems">Monitoring CPU Utilization on SPARC T-Series Systems</h2>
        
        <footer class="article-footer">
          <a data-url="http://sicongtang.github.io/2014/05/21/2014-05-21-java-performance-os-monitoring/" data-id="8z4ga62kn9gffx6g" data_title="Java Performance   Os Monitoring"
          data_summary="Bottom Up ApproachBottom up begins at the lowest level of the software stack, at the CPU level looking at statistics such as CPU cache misses, inefficient use o..." class="article-share-link">Share</a>
          
            <a href="http://sicongtang.github.io/2014/05/21/2014-05-21-java-performance-os-monitoring/#disqus_thread" class="article-comment-link">Comments</a>
          
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/books/">books</a>
  </div>


          

        </footer>
      
    </div>
  </div>
</article>


  
    <article id="post-2yx4irxgswjg2e6c" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    

    
      <header class="article-header">
        <i class="fa fa-file-text-o"></i>
        
  
    <h1 class="archive-title" itemprop="name">
      <a class="article-title" href="/2014/04/29/2014-04-29-python-environment-setup/">Python Environment Setup</a>
    </h1>
  


        <div class="article-date">
  <time datetime="2014-04-29T00:10:26.000Z" itemprop="datePublished">Apr 29 2014</time>
</div>

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
          <p>Python is a script language, the main idea for learning python is to utilize python to create easy hands-on automation script on linux env instead of shell.</p>
<p>Here, list the steps to configure PyDev, an eclipse plugin, inside eclipse environment.</p>
<ol>
<li>Access PyDev webpage: <a href="http://pydev.org/manual_101_install.html" target="_blank" rel="external">http://pydev.org/manual_101_install.html</a></li>
<li>Download PyDev certificate</li>
<li>cd %JAVA_HOME%/bin</li>
<li>Run command: keytool.exe -import -file C:/download/pydev_certificate.cer -keystore %JAVA_HOME%/jre/lib/security/cacerts</li>
<li>Input default JDK cacerts password: changeit</li>
<li>Certificate installment completed</li>
<li>Download eclipse plugin on marketplace, or mannually download it and extract into dropins directory like: (dropins/pydev/eclipse/...)</li>
<li>Edit eclipse.ini, convert -vm=... JDK must be 1.7</li>
<li>Access JPython webpage: <a href="https://wiki.python.org/jython/InstallationInstructions" target="_blank" rel="external">https://wiki.python.org/jython/InstallationInstructions</a></li>
<li>Download Jython 2.5.4rc1 - Traditional Installer at link: <a href="http://jython.org/downloads.html" target="_blank" rel="external">http://jython.org/downloads.html</a></li>
<li>Run command: java -jar jython_installer-2.5.2.jar --console</li>
<li>Configure JPython interceptor in PvDev eclipse plugin</li>
</ol>

        
        <footer class="article-footer">
          <a data-url="http://sicongtang.github.io/2014/04/29/2014-04-29-python-environment-setup/" data-id="2yx4irxgswjg2e6c" data_title="Python Environment Setup"
          data_summary="Python is a script language, the main idea for learning python is to utilize python to create easy hands-on automation script on linux env instead of shell.
Her..." class="article-share-link">Share</a>
          
            <a href="http://sicongtang.github.io/2014/04/29/2014-04-29-python-environment-setup/#disqus_thread" class="article-comment-link">Comments</a>
          
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/devenvsetup-python/">devenvsetup python</a>
  </div>


          

        </footer>
      
    </div>
  </div>
</article>


  
    <article id="post-840b6clvwldclfsa" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    

    
      <header class="article-header">
        <i class="fa fa-file-text-o"></i>
        
  
    <h1 class="archive-title" itemprop="name">
      <a class="article-title" href="/2014/04/27/2014-04-27-operating-system-concepts-io-system/">Operating System Concepts   Io System</a>
    </h1>
  


        <div class="article-date">
  <time datetime="2014-04-27T09:43:57.000Z" itemprop="datePublished">Apr 27 2014</time>
</div>

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
          <h2 id="i/o-hardware">I/O Hardware</h2><p>The device communicates with the machine via a connection point, or <strong>port</strong> — for example, a serial port.</p>
<p>If devices use a common set of wires, the connection is called a bus. A <strong>bus</strong> is a set of wires and a rigidly defined protocol that specifies a set of messages that can be sent on the wires.</p>
<p>This figure shows a <strong>PCI bus</strong> (the common PC system bus) that connects the processor–memory subsystem to the fast devices and an expansion bus that connects relatively slow devices, such as the keyboard and serial and USB ports.</p>
<img src="https://farm8.staticflickr.com/7406/14029529882_f49ab52235_z.jpg" title="pcbus_structure.png">


<p>A <strong>controller</strong> is a collection of electronics that can operate a port, a bus, or a device. A serial-port controller is a simple device controller. It is a single chip (or portion of a chip) in the computer that controls the signals on the wires of a serial port.</p>
<p>By contrast, a <strong>SCSI bus controller</strong> is not simple. Because the SCSI protocol is complex, the SCSI bus controller is often implemented as a separate circuit board (or a host adapter) that plugs into the computer. It typically contains a processor, microcode, and some private memory to enable it to process the SCSI protocol messages.</p>
<h2 id="polling-&amp;-interrupts">Polling &amp; Interrupts</h2><p>In many computer architectures, three CPU-instruction cycles are sufficient to poll a device: read a device register, logical–and to extract a status bit, and branch if not zero. But <strong>polling</strong> becomes inefficient when it is attempted repeatedly yet rarely finds a device to be ready for service, while other useful CPU processing remains undone.</p>
<p>The hardware mechanism that enables a device to notify the CPU is called an <strong>interrupt</strong>.</p>
<p>The basic interrupt mechanism works as follows. The CPU hardware has a wire called the <strong>interrupt-request line</strong> that the CPU senses after executing every instruction. When the CPU detects that a controller has asserted a signal on the interrupt-request line, the CPU performs a state save and jumps to the <strong>interrupt-handler routine</strong> at a fixed address in memory.</p>
<p>Another example is found in the implementation of system calls. Usually, a program uses library calls to issue system calls. The library routines check the arguments given by the application, build a data structure to convey the arguments to the kernel, and then execute a special instruction called a <strong>software interrupt</strong>, or <strong>trap</strong>.</p>
<h2 id="direct-memory-access">Direct Memory Access</h2><p>For a device that does large transfers, such as a disk drive, it seems wasteful to use an expensive general-purpose processor to watch status bits and to feed data into a controller register one byte at a time—a process termed <strong>programmed I/O (PIO)</strong>. Many computers avoid burdening the main CPU with PIO by offloading some of this work to a special-purpose processor called a <strong>direct-memory-access (DMA) controller</strong>.</p>
<img src="https://farm8.staticflickr.com/7340/14029558121_fb7debb6a5_z.jpg" title="DMA_transfer.png">

<h2 id="blocking-and-nonblocking-i/o">Blocking and Nonblocking I/O</h2><p>An alternative to a nonblocking system call is an asynchronous system call. An asynchronous call returns immediately, without waiting for the I/O to complete.</p>
<p>The difference between nonblocking and asynchronous system calls is that a nonblocking read() returns immediately with whatever data are available—the full number of bytes requested, fewer, or none at all. An asynchronous read() call requests a transfer that will be performed in its entirety but will complete at some future time. </p>
<img src="https://farm3.staticflickr.com/2927/14032739105_b20504ca80_z.jpg" title="syn_asyn_io.png">

<h2 id="buffering">Buffering</h2><p>A <strong>buffer</strong> is a memory area that stores data being transferred between two devices or between a device and an application.</p>
<p>Buffering is done for three reasons. </p>
<ol>
<li>One reason is to cope with a speed mismatch between the producer and consumer of a data stream.</li>
<li>A second use of buffering is to provide adaptations for devices that have different data-transfer sizes.</li>
<li>A third use of buffering is to support <strong>copy semantics</strong> for application I/O.</li>
</ol>
<p>With <strong>copy semantics</strong>, the version of the data written to disk is guaranteed to be the version at the time of the application system call, independent of any subsequent changes in the application’s buffer. A simple way in which the operating system can guarantee copy semantics is for the write() system call to copy the application data into a kernel buffer before returning control to the application. The disk write is performed from the kernel buffer, so that subsequent changes to the application buffer have no effect.</p>
<h2 id="caching">Caching</h2><p>A <strong>cache</strong> is a region of fast memory that holds copies of data.</p>
<p>When the kernel receives a file I/O request, the kernel first accesses the buffer cache to see whether that region of the file is already available in main memory. If it is, a physical disk I/O can be avoided or deferred.</p>
<h2 id="transforming-i/o-requests-to-hardware-operations">Transforming I/O Requests to Hardware Operations</h2><p>The figure suggests that an I/O operation requires a great many steps that together consume a tremendous number of CPU cycles.</p>
<ol>
<li>A process issues a blocking read() system call to a file descriptor of a file that has been opened previously.</li>
<li>The system-call code in the kernel checks the parameters for correctness. In the case of input, if the data are already available in the buffer cache, the data are returned to the process, and the I/O request is completed.</li>
<li>Otherwise, a physical I/O must be performed. The process is removed from the run queue and is placed on the wait queue for the device, and the I/O request is scheduled. Eventually, the I/O subsystem sends the request to the device driver. Depending on the operating system, the request is sent via a subroutine call or an in-kernel message.</li>
<li>The device driver allocates kernel buffer space to receive the data and schedules the I/O. Eventually, the driver sends commands to the device controller by writing into the device-control registers.</li>
<li>The device controller operates the device hardware to perform the data transfer.</li>
<li>The driver may poll for status and data, or it may have set up a DMA transfer into kernel memory. We assume that the transfer is managed by a DMA controller, which generates an interrupt when the transfer completes.</li>
<li>The correct interrupt handler receives the interrupt via the interrupt- vector table, stores any necessary data, signals the device driver, and returns from the interrupt.</li>
<li>The device driver receives the signal, determines which I/O request has completed, determines the request’s status, and signals the kernel I/O subsystem that the request has been completed.</li>
<li>The kernel transfers data or return codes to the address space of the requesting process and moves the process from the wait queue back to the ready queue.</li>
<li>Moving the process to the ready queue unblocks the process. When the scheduler assigns the process to the CPU, the process resumes execution at the completion of the system call.</li>
</ol>

        
        <footer class="article-footer">
          <a data-url="http://sicongtang.github.io/2014/04/27/2014-04-27-operating-system-concepts-io-system/" data-id="840b6clvwldclfsa" data_title="Operating System Concepts   Io System"
          data_summary="I/O HardwareThe device communicates with the machine via a connection point, or port — for example, a serial port.
If devices use a common set of wires, the co..." class="article-share-link">Share</a>
          
            <a href="http://sicongtang.github.io/2014/04/27/2014-04-27-operating-system-concepts-io-system/#disqus_thread" class="article-comment-link">Comments</a>
          
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/books/">books</a>
  </div>


          

        </footer>
      
    </div>
  </div>
</article>


  
    <article id="post-ros9cldxbhkm6b86" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    

    
      <header class="article-header">
        <i class="fa fa-file-text-o"></i>
        
  
    <h1 class="archive-title" itemprop="name">
      <a class="article-title" href="/2014/04/27/2014-04-27-operating-system-concepts-memorymapped-file/">Operating System Concepts   Memory Mapped File</a>
    </h1>
  


        <div class="article-date">
  <time datetime="2014-04-27T09:18:34.000Z" itemprop="datePublished">Apr 27 2014</time>
</div>

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
          
        
        <footer class="article-footer">
          <a data-url="http://sicongtang.github.io/2014/04/27/2014-04-27-operating-system-concepts-memorymapped-file/" data-id="ros9cldxbhkm6b86" data_title="Operating System Concepts   Memory Mapped File"
          data_summary="" class="article-share-link">Share</a>
          
            <a href="http://sicongtang.github.io/2014/04/27/2014-04-27-operating-system-concepts-memorymapped-file/#disqus_thread" class="article-comment-link">Comments</a>
          
          

          

        </footer>
      
    </div>
  </div>
</article>


  
  
<div class="center">
  <ul class="pagination">
    <li>
      
        <span class="nav-prev disabled">Prev</span>
      
    </li>
    <li>
      <a href="/" class="nav-home">Home</a>
    </li>
    <li>
      
        <a href="/page/2/" class="nav-next">Next</a>
      
    </li>
  </ul>
</div>




</section>
        
          
<aside id="sidebar">
  
    
      <div class="widget-wrap">
    <div id="search-form-wrap">
      <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="submit" value="&#xF002;" class="search-form-submit"><input type="hidden" name="q" value="site:http://sicongtang.github.io"></form>
    </div>
</div>

    
      
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <a class="category-link" href="/categories/books/">books<span class="category-count">8</span></a><a class="category-link" href="/categories/devenvsetup-emacs/">devenvsetup emacs<span class="category-count">1</span></a><a class="category-link" href="/categories/devenvsetup-python/">devenvsetup python<span class="category-count">1</span></a><a class="category-link" href="/categories/devenvsetup-ruby/">devenvsetup ruby<span class="category-count">1</span></a><a class="category-link" href="/categories/javascript/">javascript<span class="category-count">2</span></a><a class="category-link" href="/categories/sql/">sql<span class="category-count">3</span></a><a class="category-link" href="/categories/test/">test<span class="category-count">1</span></a><a class="category-link" href="/categories/web/">web<span class="category-count">1</span></a>
    </div>
  </div>


    
      

    
      
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/05/">May 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">April 2014</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/03/">March 2014</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/01/">January 2014</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget-wrap">
    <h3 class="widget-title">Links</h3>
    <div class="widget">
      <ul>
        
         <li class="blogroll">
           
             <i class="fa fa-github"></i>
           
           <a href="https://github.com/" title="Github">Github</a>
          </li>
        
         <li class="blogroll">
           
             <i class="fa fa-google-plus"></i>
           
           <a href="https://plus.google.com/" title="Google+">Google+</a>
          </li>
        
      </ul>
    </div>
  </div>


    
  
</aside>


        
      </div>
      <footer id="footer">
  
  <div class="outer container">
    <div id="footer-info" class="inner">
      <a href="/">BobbyTang Tech Blog</a> &copy; 2014 Powered by <a href="http://zespia.tw/hexo/" target="_blank">Hexo</a> and Theme by <a href="https://github.com/seff/nut" target="_blank">Nut</a>
    </div>
  </div>
</footer>
<a id="gotop" href="#">
  <i class="fa fa-chevron-up"></i>
</a>

    </div>
    <nav id="mobile-nav">
  
    <a href="[object Object]" class="mobile-nav-link">0</a>
  
    <a href="[object Object]" class="mobile-nav-link">1</a>
  
    <a href="[object Object]" class="mobile-nav-link">2</a>
  
    <a href="[object Object]" class="mobile-nav-link">3</a>
  
    <a href="[object Object]" class="mobile-nav-link">4</a>
  
</nav>

    
<script>
  var disqus_shortname = 'bobbytang';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>

<script src="/js/jquery.fitvids.js" type="text/javascript"></script>

<script src="/js/bootstrap.min.js" type="text/javascript"></script>

<script src="/js/script.js" type="text/javascript"></script>


  </div>
</body>
</html>
