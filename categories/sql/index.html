<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Category: sql | BobbyTang&#39;s Tech Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="BobbyTang's Tech Blog">
<meta property="og:url" content="http://sicongtang.github.io/categories/sql/">
<meta property="og:site_name" content="BobbyTang's Tech Blog">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="BobbyTang's Tech Blog">
<meta name="twitter:description">

  
    <link rel="alternative" href="/atom.xml" title="BobbyTang&#39;s Tech Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link href="http://fonts.useso.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.min.css" type="text/css">

  <link rel="stylesheet" href="/css/bootstrap.min.css" type="text/css">

  <link rel="stylesheet" href="/css/style.css" type="text/css">

  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-57015869-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


</head>

<body>
  <div id="container">
    <div id="wrap">
      <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">BobbyTang&#39;s Tech Blog</a>
    <div class="collapse navbar-collapse nav-menu">
      <ul class="nav navbar-nav">
      
        <li>
          <a href="/archives">
            <i class="fa fa-archive"></i>
            Archives
          </a>
        </li>
      
        <li>
          <a href="/categories">
            <i class="fa fa-folder"></i>
            Categories
          </a>
        </li>
      
        <li>
          <a href="/tags">
            <i class="fa fa-tags"></i>
            Tags
          </a>
        </li>
      
        <li>
          <a href="/wiki">
            <i class="fa fa-book"></i>
            Wiki
          </a>
        </li>
      
        <li>
          <a href="/about">
            <i class="fa fa-user"></i>
            About
          </a>
        </li>
      
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
          <li><a id="rss-link" href="/atom.xml" title="RSS Feed"><i class="fa fa-rss"></i></a></li>
        
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>

      <div id='content' class="container">

        <div class="page-header-wrapper">
          <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
          <div class="page-header">
            <h1 class="title">
          
            
              sql
            
          
            </h1>
        </div>
      </div>
      
      <section id="main"
        
      >
  
  
    <article id="post-zt779agwbolm4z3m" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    

    
      <header class="article-header">
        <i class="fa fa-file-text-o"></i>
        
  
    <h1 class="archive-title" itemprop="name">
      <a class="article-title" href="/2015/09/27/DB2-SQL-Tuning-Tips/">Db2 Sql Tuning Tips</a>
    </h1>
  


        <div class="article-date">
  <time datetime="2015-09-27T13:18:24.000Z" itemprop="datePublished">Sep 27 2015</time>
</div>

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
          <p>List most critical tips from <a href="https://www.safaribooksonline.com/library/view/db2-sql-tuning/9780133038484/" target="_blank" rel="external">DB2 SQL Tuning Tips for z/OS Developers</a></p>
<ol>
<li><p>Stay Away from Distinct if Possbile
Details: <code>group by</code> or <code>in or exists subquery</code> if duplicates due to one-to-many relationship</p>
</li>
<li><p>Try Rewriting Range Predicates as Between Predicates</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">WHERE HIREDATE &gt; :HV-DATE</div><div class="line">WHERE HIREDATE BETWEEN :HV-DATE and '9999-12-31'</div></pre></td></tr></table></figure>
</li>
<li><p>Use Tools for Monitoring
Details: Some of the most common z/OS DB2 monitoring tools are OMEGAMON®, TMon, MainView, Apptune, Insight for DB2, and DB2PM. Some of the most common DB2 LUW monitoring tools are IBM’s Optim™ Query Tuner, Precise for DB2, Quest, DBI Software, Embarcadero’s Performance Analyst, and ITGAIN.</p>
</li>
<li><p>Avoid Discrepancies with Non-Column Expressions</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">WHERE EDLEVEL = 123.45 * 12</div><div class="line">WHERE EDLEVEL = SMALLINT(ROUND(123.45*12,0))</div></pre></td></tr></table></figure>
</li>
<li><p>Ensure That Subquery Predicates Involving Min and Max Have the Possibility of Nulls Being Returned Handled</p>
</li>
<li><p>Always Code For Fetch Only or For Read Only with Cursor Processing When a Query Is Only Selecting Data</p>
</li>
<li><p>Avoid Selecting a Row from a Table to Help Decide Whether the Logic in the Code Should Execute an Update or an Insert</p>
</li>
<li><p>Use the DB2 V9 MERGE Statement</p>
</li>
<li><p>Keep Table and Index Files Healthy and Organized
Details: SYSIBM.SYSTABLESPACESTATS and SYSIBM.SYSINDEXSPACESTATS tables</p>
</li>
<li><p>Consider OLTP Front-End Processing</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">OPTIMIZE</span> <span class="keyword">FOR</span> <span class="number">14</span> <span class="keyword">ROWS</span></span></div></pre></td></tr></table></figure>
</li>
<li><p>Take Advantage of Materialized Query Tables to Improve Response Time (Dynamic SQL Only)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> DEPT_SUM_MQT_TABLE <span class="keyword">AS</span></span></div><div class="line">(<span class="keyword">SELECT</span>  WORKDEPT, <span class="keyword">AVG</span>(SALARY) <span class="keyword">AS</span> AVG_SAL,</div><div class="line"><span class="keyword">AVG</span>(BONUS) <span class="keyword">AS</span> AVG_BONUS</div><div class="line"><span class="keyword">AVG</span>(COMM)  <span class="keyword">AS</span> AVG_COMM,</div><div class="line"><span class="keyword">SUM</span>(SALARY) <span class="keyword">AS</span> SUM_SAL,</div><div class="line"><span class="keyword">SUM</span>(BONUS) <span class="keyword">AS</span> SUM_BONUS</div><div class="line"><span class="keyword">SUM</span>(COMM)  <span class="keyword">AS</span> SUM_COMM</div><div class="line"><span class="keyword">FROM</span> EMP</div><div class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span>  WORKDEPT)</div><div class="line"><span class="keyword">DATA</span> <span class="keyword">INITIALLY</span> <span class="keyword">DEFERRED</span> REFRESH <span class="keyword">DEFERRED</span></div><div class="line">MAINTAINED <span class="keyword">BY</span> SYSTEM</div><div class="line">ENABLE <span class="keyword">QUERY</span> OPTIMIZATION;</div><div class="line"><span class="comment">--original query</span></div><div class="line"><span class="operator"><span class="keyword">SELECT</span> <span class="keyword">SUM</span>(BONUS)</span></div><div class="line"><span class="keyword">FROM</span> EMP</div><div class="line"><span class="keyword">WHERE</span>  WORKDEPT = <span class="string">'A00'</span></div><div class="line"><span class="comment">--rewrite by optimize</span></div><div class="line"><span class="keyword">SELECT</span> AVG_BONUS</div><div class="line"><span class="keyword">FROM</span> DEPT_SUM_MQT_TABLE</div><div class="line"><span class="keyword">WHERE</span>  WORKDEPT = <span class="string">'A00'</span></div></pre></td></tr></table></figure>
</li>
<li><p>Insert with Select</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">SELECT</span> EMPNO, LASTNAME, MIDINIT, FIRSTNME,</span></div><div class="line">DEPTNO, SALARY, BONUS, COMM</div><div class="line"><span class="keyword">FROM</span> FINAL <span class="keyword">TABLE</span></div><div class="line">(<span class="keyword">INSERT</span>   (EMPNO, LASTNAME, MIDINIT, FIRSTNME, DEPTNO)</div><div class="line"><span class="keyword">VALUES</span> (<span class="string">'123456'</span>, <span class="string">'SMITH'</span>, <span class="string">'A'</span>, <span class="string">'JOE'</span>, <span class="string">'A00'</span>)</div><div class="line">)</div></pre></td></tr></table></figure>
</li>
<li><p>Identify Times for Volatile Tables
Details: Using the VOLATILE keyword on the Create or Alter Table statement identifies tables whose data volumes fluctuate.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> EMP_TEMP</span></div><div class="line"> (EMPNO    <span class="built_in">CHAR</span>(<span class="number">6</span>)  <span class="keyword">Not</span> <span class="literal">Null</span>,</div><div class="line">   LASTNAME <span class="built_in">VARCHAR</span>(<span class="number">15</span>)  <span class="keyword">Not</span> <span class="literal">Null</span> )</div><div class="line">   VOLATILE</div></pre></td></tr></table></figure>
</li>
<li><p>Use the ON COMMIT DROP Enhancement</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">DECLARE</span> <span class="keyword">GLOBAL</span> <span class="keyword">TEMPORARY</span> <span class="keyword">TABLE</span></span></div><div class="line"><span class="keyword">SESSION</span>.EMP_TEMP1  (COL1 <span class="built_in">CHAR</span> (<span class="number">20</span>)</div><div class="line">COL2 <span class="built_in">CHAR</span> (<span class="number">10</span>)</div><div class="line">COL3 <span class="built_in">SMALLINT</span> )</div><div class="line"><span class="keyword">ON</span> <span class="keyword">COMMIT</span> <span class="keyword">DROP</span> <span class="keyword">TABLE</span></div><div class="line"></div><div class="line"><span class="keyword">ON</span> <span class="keyword">COMMIT</span> <span class="keyword">DELETE</span> <span class="keyword">ROWS</span></div><div class="line"><span class="keyword">ON</span> <span class="keyword">COMMIT</span> <span class="keyword">PRESERVE</span> <span class="keyword">ROWS</span></div></pre></td></tr></table></figure>
</li>
<li><p>Use Multiple Distincts
Details: This is an automatic performance gain that alleviates the need for separate calls to DB2.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">SELECT</span> <span class="keyword">SUM</span> (<span class="keyword">DISTINCT</span> SALARY),</span></div><div class="line">     <span class="keyword">AVG</span>(<span class="keyword">DISTINCT</span> BONUS)</div><div class="line">     <span class="keyword">FROM</span> EMP;</div></pre></td></tr></table></figure>
</li>
<li><p>Take Advantage of Backward Index Scanning
Details: For each column that is in the Order By clause, the ordering that is specified in the index has to be exactly the opposite of the ordering that is specified in the Order By clause.</p>
</li>
<li><p>Set Your Clustering Index Correctly</p>
</li>
<li><p>Take Advantage of DB2 V8 Enhanced DISCARD Capabilities When It Comes to Mass Deletes</p>
</li>
<li><p>Consider Parallelism
<a href="https://www-01.ibm.com/support/knowledgecenter/SSEPEK_11.0.0/com.ibm.db2z11.doc.perf/src/tpc/db2z_enableparallelprocess.dita" target="_blank" rel="external">https://www-01.ibm.com/support/knowledgecenter/SSEPEK_11.0.0/com.ibm.db2z11.doc.perf/src/tpc/db2z_enableparallelprocess.dita</a></p>
</li>
<li><p>Consider Direct Row Access Using ROWID Datatype (V8) or RID Function (V9)
Details: If the ROWID value is then used in the search condition of subsequent updates or deletes, DB2 may navigate directly to the row, bypassing any index processing or tablespace scans.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">EMP_ID     ROWID    NOT NULL GENERATED ALWAYS</div></pre></td></tr></table></figure>
</li>
<li><p>Specify the Leading Index Columns in WHERE Clauses
Details: For a composite index, the following query would use the index and execute matching processing as long as the leading column of the index is specified in the WHERE clause.</p>
</li>
<li><p>Keep in Mind Index Only Processing Whenever Possible
Many times, developers code queries that need to execute one of the four column aggregate functions (Sum, Avg, Min, or Max). They can get some great results by including an extra column as part of an index. Take, for example, the following query and associated index, Index1 = (YEAR, PERIOD):
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">SELECT</span> <span class="keyword">SUM</span>(JRNL_AMT)</span></div><div class="line"><span class="keyword">FROM</span> LEDGER_TABLE</div><div class="line"><span class="keyword">WHERE</span> <span class="keyword">YEAR</span> = <span class="number">2008</span> <span class="keyword">AND</span> PERIOD <span class="keyword">IN</span> (<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</div></pre></td></tr></table></figure>
DB2 is good at recognizing the JRNL_AMT column in the index, even though there is no specific predicate on it, and it will choose index only processing.</p>
</li>
<li><p>Take Advantage of DB2 V9 Optimistic Locking</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> EMP</span></div><div class="line"> (EMPNO  <span class="built_in">CHAR</span>(<span class="number">6</span>)  <span class="keyword">NOT</span> <span class="literal">NULL</span>,</div><div class="line">   ....</div><div class="line">   .....</div><div class="line">   EMP_UPD  <span class="keyword">TIMESTAMP</span> <span class="keyword">NOT</span> <span class="literal">NULL</span></div><div class="line">   GENERATED <span class="keyword">BY</span> <span class="keyword">DEFAULT</span></div><div class="line">   <span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="keyword">ROW</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span></div><div class="line">   <span class="keyword">AS</span> <span class="keyword">ROW</span> <span class="keyword">CHANGE</span> <span class="keyword">TIMESTAMP</span>)</div><div class="line">)</div></pre></td></tr></table></figure>
</li>
<li><p>Use the DB2 V9 MERGE Statement
<a href="https://www-01.ibm.com/support/knowledgecenter/SSEPGG_9.7.0/com.ibm.db2.luw.sql.ref.doc/doc/r0010873.html" target="_blank" rel="external">https://www-01.ibm.com/support/knowledgecenter/SSEPGG_9.7.0/com.ibm.db2.luw.sql.ref.doc/doc/r0010873.html</a></p>
</li>
<li><p>Code Boolean Term Predicates Whenever Possible
Details: A Boolean term predicate is a predicate that is connected by And logic, so when one predicate is evaluated as false for a row, it then makes the entire Where clause evaluate to false.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">SELECT</span> EMPNO, LASTNAME, SALARY</span></div><div class="line"><span class="keyword">FROM</span> EMP</div><div class="line"><span class="keyword">WHERE</span> (LASTNAME &gt; <span class="string">'SMITH'</span>)</div><div class="line"><span class="keyword">OR</span> (LASTNAME = <span class="string">'SMITH'</span> <span class="keyword">and</span> FIRSTNME &gt; <span class="string">'BOB'</span>)</div><div class="line"></div><div class="line"><span class="keyword">SELECT</span> EMPNO, LASTNAME, SALARY</div><div class="line"><span class="keyword">FROM</span> EMP</div><div class="line"><span class="keyword">WHERE</span>  LASTNAME &gt;= <span class="string">'SMITH'</span></div><div class="line">  <span class="keyword">AND</span> (LASTNAME &gt;  <span class="string">'SMITH'</span>   <span class="keyword">OR</span></div><div class="line">      (LASTNAME = <span class="string">'SMITH'</span> <span class="keyword">AND</span> FIRSTNME &gt; <span class="string">'BOB'</span>))</div></pre></td></tr></table></figure>
</li>
<li><p>Avoid Sorts with Order By
Details: DB2 may avoid sorts if there are leading columns in an index to match the Order By or if the query contains an equal predicate on the leading column(s) of an index.</p>
</li>
<li><p>Watch Out for Case Logic
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">SELECT</span> EMPNO, LASTNAME, SALARY,</span></div><div class="line">       <span class="keyword">CASE</span> <span class="keyword">WHEN</span> SALARY &lt; ...</div><div class="line">            <span class="keyword">WHEN</span> SALARY &gt; ...</div><div class="line">       <span class="keyword">ELSE</span></div><div class="line">       <span class="keyword">END</span></div><div class="line"><span class="keyword">FROM</span> EMP</div></pre></td></tr></table></figure>
Details: If most of the rows have a Salary &lt; 50000.00, then that piece of logic should be coded first.</p>
</li>
<li><p>Know Your Version of DB2</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">SELECT</span> GETVARIABLE(<span class="string">'SYSIBM.VERSION'</span>)</span></div><div class="line"><span class="keyword">FROM</span> SYSIBM.SYSDUMMY1</div></pre></td></tr></table></figure>
</li>
<li><p>If You Need True Uniqueness, Try the V8 Generate_Unique Function</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> ORDER_TBL</span></div><div class="line"> (ORDER_ID        <span class="built_in">CHAR</span>(<span class="number">13</span>) <span class="keyword">FOR</span> <span class="built_in">BIT</span> <span class="keyword">DATA</span>,</div><div class="line">  ORDER_DATE      <span class="built_in">DATE</span>,</div><div class="line">  ORDER_LOC       <span class="built_in">CHAR</span>(<span class="number">03</span>) );</div><div class="line"></div><div class="line"><span class="operator"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> ORDER_TBL</span></div><div class="line">  <span class="keyword">VALUES</span>(GENERATE_UNIQUE(), <span class="keyword">CURRENT</span> <span class="built_in">DATE</span>, <span class="string">'NY'</span>);</div><div class="line"></div><div class="line"><span class="operator"><span class="keyword">SELECT</span> <span class="keyword">TIMESTAMP</span>(ORDER_ID), <span class="keyword">ORDER</span> <span class="built_in">DATE</span>, ....</span></div><div class="line"><span class="keyword">FROM</span> ORDER_TBL;</div></pre></td></tr></table></figure>
</li>
<li><p>Update and Delete with Select (V9)
Details: The words Old Table are SQL DB2 reserved words that need to be coded in order for this statement to work.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">SELECT</span> SALARY, BONUS</span></div><div class="line"><span class="keyword">FROM</span> OLD <span class="keyword">TABLE</span></div><div class="line"> (<span class="keyword">UPDATE</span> EMP</div><div class="line">    <span class="keyword">SET</span> SALARY = :HV1-SALARY,</div><div class="line">    BONUS = :HV2-BONUS</div><div class="line">    <span class="keyword">WHERE</span> EMPNO = :HV-EMPNO)</div><div class="line"><span class="keyword">SELECT</span> LASTNAME, FIRSTNME, WORKDEPT</div><div class="line"><span class="keyword">FROM</span> OLD <span class="keyword">TABLE</span></div><div class="line">  (<span class="keyword">DELETE</span> <span class="keyword">FROM</span> EMP</div><div class="line">   <span class="keyword">WHERE</span> EMPNO = :HV-EMPNO)</div></pre></td></tr></table></figure>
</li>
<li><p>Avoid Unnecessary Sorting
Details: Data sorting can be caused by Group By, Order By, Distinct, Union, Intersect, Except, and Join processing.</p>
</li>
</ol>
<p>List most critical tips of store procedure related from <a href="https://www.safaribooksonline.com/library/view/db2-sql-tuning/9780133038484/" target="_blank" rel="external">DB2 SQL Tuning Tips for z/OS Developers</a></p>

        
        <footer class="article-footer">
          <a data-url="http://sicongtang.github.io/2015/09/27/DB2-SQL-Tuning-Tips/" data-id="zt779agwbolm4z3m" data_title="Db2 Sql Tuning Tips"
          data_summary="List most critical tips from DB2 SQL Tuning Tips for z/OS Developers

Stay Away from Distinct if Possbile
Details: group by or in or exists subquery if duplicat..." class="article-share-link">Share</a>
          
            <a href="http://sicongtang.github.io/2015/09/27/DB2-SQL-Tuning-Tips/#disqus_thread" class="article-comment-link">Comments</a>
          
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/sql/">sql</a>
  </div>


          

        </footer>
      
    </div>
  </div>
</article>


  
    <article id="post-stjtprvs42d0pcr9" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    

    
      <header class="article-header">
        <i class="fa fa-file-text-o"></i>
        
  
    <h1 class="archive-title" itemprop="name">
      <a class="article-title" href="/2014/09/02/mongodb-crud-summary/">Mongo Db Crud Summary</a>
    </h1>
  


        <div class="article-date">
  <time datetime="2014-09-02T05:41:21.000Z" itemprop="datePublished">Sep 2 2014</time>
</div>

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
          <!---->
          <p>This post aims to list the basic operation of mongo database in the mongodb shell prompt.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">w, {Number/String, &gt; -<span class="number">1</span> || ‘majority’ || tag <span class="property">name</span>} <span class="keyword">the</span> <span class="command">write</span> concern <span class="keyword">for</span> <span class="keyword">the</span> operation <span class="keyword">where</span> &lt; <span class="number">1</span> <span class="keyword">is</span> no acknowlegement <span class="keyword">of</span> <span class="command">write</span> <span class="keyword">and</span> w &gt;= <span class="number">1</span>, w = ‘majority’ <span class="keyword">or</span> tag acknowledges <span class="keyword">the</span> <span class="command">write</span></div><div class="line">j, (Boolean, default:<span class="constant">false</span>) <span class="command">write</span> waits <span class="keyword">for</span> journal sync <span class="keyword">before</span> <span class="keyword">returning</span></div></pre></td></tr></table></figure>

<h2 id="system-admin">system admin</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">mongod --fork --logpath /root/mongodb/log/mongodb.log</div><div class="line">mongod —shutdown</div><div class="line">mongo hostname:port/dbschema -u username -p password</div><div class="line">db.serverStatus()</div><div class="line">db.serverStatus().connections</div></pre></td></tr></table></figure>


          
            <p class="article-more-link">
              <a href="/2014/09/02/mongodb-crud-summary/#more">Read More</a>
            </p>
          
        
        <footer class="article-footer">
          <a data-url="http://sicongtang.github.io/2014/09/02/mongodb-crud-summary/" data-id="stjtprvs42d0pcr9" data_title="Mongo Db Crud Summary"
          data_summary="This post aims to list the basic operation of mongo database in the mongodb shell prompt.
12w, {Number/String, &gt; -1 || ‘majority’ || tag name} the write co..." class="article-share-link">Share</a>
          
            <a href="http://sicongtang.github.io/2014/09/02/mongodb-crud-summary/#disqus_thread" class="article-comment-link">Comments</a>
          
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/sql/">sql</a>
  </div>


          

        </footer>
      
    </div>
  </div>
</article>


  
    <article id="post-8mias3j8h71yf7l1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    

    
      <header class="article-header">
        <i class="fa fa-file-text-o"></i>
        
  
    <h1 class="archive-title" itemprop="name">
      <a class="article-title" href="/2014/03/10/sql-sybasease-alternative-way-to-support-lead-slash-lag-function/">Sql   Sybase Ase   Alternative Way to Support Lead/Lag Function</a>
    </h1>
  


        <div class="article-date">
  <time datetime="2014-03-09T17:32:05.000Z" itemprop="datePublished">Mar 10 2014</time>
</div>

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
          <p>There is audit trial requirement that need to be captured into log table these day. But we suffer from the limited function provided by Sybase ASE DB in order to achieve our goals. SybaseASE 12.5 does not support neither analytic function nor row number column, and therefore we have to implement cross comparison by ourselves via basic semantics.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">--create rownum column</span></div><div class="line"><span class="operator"><span class="keyword">select</span> rownum = <span class="keyword">identity</span>(<span class="number">10</span>), * <span class="keyword">from</span> #temp_table <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">where</span> <span class="number">1</span>=<span class="number">2</span></span></div><div class="line"><span class="keyword">insert</span> <span class="keyword">into</span> #temp_table</div><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">where</span> pid = @pid</div><div class="line"><span class="keyword">insert</span> <span class="keyword">into</span> #temp_table</div><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> table_history <span class="keyword">where</span> pid = @pid <span class="keyword">order</span> <span class="keyword">by</span> audit_update_date <span class="keyword">desc</span></div><div class="line"><span class="comment">--use self-join to match the cross rows</span></div><div class="line"><span class="keyword">select</span> a.rownum,</div><div class="line">		<span class="keyword">case</span> <span class="keyword">when</span> a.col1 = b.col1 <span class="keyword">then</span> <span class="string">'equal'</span> <span class="keyword">else</span> <span class="string">'inequal'</span> <span class="keyword">end</span></div><div class="line"><span class="keyword">from</span> #temp_table a <span class="keyword">left</span> out <span class="keyword">join</span> #temp_table b <span class="keyword">on</span> ( a.pid = b.pid <span class="keyword">and</span> (a.rownum + <span class="number">1</span>) = b.rownum )</div><div class="line"><span class="keyword">where</span> ...</div></pre></td></tr></table></figure>

<p>In contrast, we also provide oracle version of implementation.</p>

        
        <footer class="article-footer">
          <a data-url="http://sicongtang.github.io/2014/03/10/sql-sybasease-alternative-way-to-support-lead-slash-lag-function/" data-id="8mias3j8h71yf7l1" data_title="Sql   Sybase Ase   Alternative Way to Support Lead/Lag Function"
          data_summary="There is audit trial requirement that need to be captured into log table these day. But we suffer from the limited function provided by Sybase ASE DB in order t..." class="article-share-link">Share</a>
          
            <a href="http://sicongtang.github.io/2014/03/10/sql-sybasease-alternative-way-to-support-lead-slash-lag-function/#disqus_thread" class="article-comment-link">Comments</a>
          
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/sql/">sql</a>
  </div>


          

        </footer>
      
    </div>
  </div>
</article>


  
    <article id="post-awbg60kd8i2ucsq1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    

    
      <header class="article-header">
        <i class="fa fa-file-text-o"></i>
        
  
    <h1 class="archive-title" itemprop="name">
      <a class="article-title" href="/2014/03/10/sql-switch-slash-transpose-columns-and-rows/">Sql   Switch/Transpose Columns and Rows</a>
    </h1>
  


        <div class="article-date">
  <time datetime="2014-03-09T16:28:27.000Z" itemprop="datePublished">Mar 10 2014</time>
</div>

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
          <p>In practice, we will meet the requirement to rotate the table including convert cols to rows, convert rows to cols. In this session, I&#39;ll produce the solution in common method as well as db-specified features.</p>
<h2 id="convert-columns-to-rows">Convert columns to rows</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">--common solution</span></div><div class="line"><span class="operator"><span class="keyword">select</span> * <span class="keyword">from</span> (</span></div><div class="line">	<span class="keyword">select</span> id, <span class="string">'col_1'</span> <span class="keyword">as</span> col_name, col_1 <span class="keyword">as</span> col_val</div><div class="line">	<span class="keyword">from</span> <span class="keyword">table</span></div><div class="line">	<span class="keyword">union</span> <span class="keyword">all</span></div><div class="line">	<span class="keyword">select</span> id, <span class="string">'col_2'</span> <span class="keyword">as</span> col_name, col_2 <span class="keyword">as</span> col_val</div><div class="line">	<span class="keyword">from</span> <span class="keyword">table</span></div><div class="line">	<span class="keyword">union</span> <span class="keyword">all</span></div><div class="line">	... </div><div class="line">) <span class="keyword">order</span> <span class="keyword">by</span> id</div></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">--oracle 11g unpivot query</span></div><div class="line"><span class="operator"><span class="keyword">select</span> *</span></div><div class="line"><span class="keyword">from</span> <span class="keyword">table</span></div><div class="line">unpivot (</div><div class="line">	col_val <span class="keyword">for</span> col_name <span class="keyword">in</span> (col_1 <span class="keyword">as</span> <span class="string">'col_1'</span>, col_2 <span class="keyword">as</span> <span class="string">'col_2'</span>)</div><div class="line">)</div><div class="line"><span class="keyword">order</span> <span class="keyword">by</span> id</div></pre></td></tr></table></figure>

<h2 id="concert-rows-to-columns">Concert rows to columns</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">--common solution</span></div><div class="line"><span class="operator"><span class="keyword">select</span> id,</span></div><div class="line">	<span class="keyword">max</span>(<span class="keyword">case</span> <span class="keyword">when</span> col_name = <span class="string">'col_1'</span> <span class="keyword">then</span> col_val <span class="keyword">else</span> <span class="literal">null</span> <span class="keyword">end</span>) <span class="keyword">as</span> col_1,</div><div class="line">	<span class="keyword">max</span>(<span class="keyword">case</span> <span class="keyword">when</span> col_name = <span class="string">'col_2'</span> <span class="keyword">then</span> col_val <span class="keyword">else</span> <span class="literal">null</span> <span class="keyword">end</span>) <span class="keyword">as</span> col_2,</div><div class="line">	...</div><div class="line"><span class="keyword">from</span> <span class="keyword">table</span></div><div class="line"><span class="keyword">order</span> <span class="keyword">by</span> id</div></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">--oracle 11g pivot query</span></div><div class="line"><span class="operator"><span class="keyword">select</span> *</span></div><div class="line"><span class="keyword">from</span> <span class="keyword">table</span></div><div class="line">pivot (</div><div class="line">	<span class="keyword">max</span>(col_val) <span class="keyword">for</span> col_name <span class="keyword">in</span> (<span class="string">'col_1'</span> <span class="keyword">as</span> col_1,<span class="string">'col_2'</span> <span class="keyword">as</span> col_2)</div><div class="line">)</div><div class="line"><span class="keyword">where</span> ...</div><div class="line"><span class="keyword">order</span> <span class="keyword">by</span> id</div></pre></td></tr></table></figure>

<h2 id="excel-pivot-table">Excel pivot table</h2><p>For non-sql approaches, we can use excel pivot table. Excel spreadsheets are a great way to pivot and analyze Oracle data, and tools.</p>

        
        <footer class="article-footer">
          <a data-url="http://sicongtang.github.io/2014/03/10/sql-switch-slash-transpose-columns-and-rows/" data-id="awbg60kd8i2ucsq1" data_title="Sql   Switch/Transpose Columns and Rows"
          data_summary="In practice, we will meet the requirement to rotate the table including convert cols to rows, convert rows to cols. In this session, I&#39;ll produce the soluti..." class="article-share-link">Share</a>
          
            <a href="http://sicongtang.github.io/2014/03/10/sql-switch-slash-transpose-columns-and-rows/#disqus_thread" class="article-comment-link">Comments</a>
          
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/sql/">sql</a>
  </div>


          

        </footer>
      
    </div>
  </div>
</article>


  
  




</section>
        
          
<aside id="sidebar">
  
    
      <div class="widget-wrap">
    <div id="search-form-wrap">
      <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="submit" value="&#xF002;" class="search-form-submit"><input type="hidden" name="q" value="site:http://sicongtang.github.io"></form>
    </div>
</div>

    
      
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li class="recent-list">
            <a href="/2015/11/04/Review-Google-Research-MapReduce/">Review Google Research: Map Reduce</a>
          </li>
        
          <li class="recent-list">
            <a href="/2015/09/27/DB2-SQL-Tuning-Tips/">Db2 Sql Tuning Tips</a>
          </li>
        
          <li class="recent-list">
            <a href="/2015/09/27/ThreadPoolExecutor-or-ProducerConsumer-Pattern/">Thread Pool Executor or Producer Consumer Pattern</a>
          </li>
        
          <li class="recent-list">
            <a href="/2015/05/12/java-generics-tips-tricks/">Java Generics Tips and Tricks</a>
          </li>
        
          <li class="recent-list">
            <a href="/2015/02/20/JVM-Internals/">Jvm Internals</a>
          </li>
        
      </ul>
    </div>
  </div>


    
      
  <div class="widget-wrap">
    <h3 class="widget-title">Links</h3>
    <div class="widget">
      <ul>
        
         <li class="blogroll">
           
             <i class="fa fa-github"></i>
           
           <a href="https://github.com/sicongtang" title="Github">Github</a>
          </li>
        
         <li class="blogroll">
           
             <i class="fa fa-google-plus"></i>
           
           <a href="https://plus.google.com/+BobbyTangSH" title="Google+">Google+</a>
          </li>
        
         <li class="blogroll">
           
             <i class="fa fa-linkedin"></i>
           
           <a href="http://cn.linkedin.com/pub/bobby-tang/43/3b9/a2" title="Linkedin">Linkedin</a>
          </li>
        
      </ul>
    </div>
  </div>


    
  
</aside>


        
      </div>
      <footer id="footer">
  
  <div class="outer container">
    <div id="footer-info" class="inner">
      <a href="/">BobbyTang&#39;s Tech Blog</a> &copy; 2015 Powered by <a href="http://zespia.tw/hexo/" target="_blank">Hexo</a> and Theme by <a href="https://github.com/seff/nut" target="_blank">Nut</a>
    </div>
  </div>
</footer>
<a id="gotop" href="#">
  <i class="fa fa-chevron-up"></i>
</a>

    </div>
    <nav id="mobile-nav">
  
    <a href="[object Object]" class="mobile-nav-link">0</a>
  
    <a href="[object Object]" class="mobile-nav-link">1</a>
  
    <a href="[object Object]" class="mobile-nav-link">2</a>
  
    <a href="[object Object]" class="mobile-nav-link">3</a>
  
    <a href="[object Object]" class="mobile-nav-link">4</a>
  
</nav>

    
<script>
  var disqus_shortname = 'bobbytang';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="/js/jquery.min.js"></script>


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>

<script src="/js/jquery.fitvids.js" type="text/javascript"></script>

<script src="/js/bootstrap.min.js" type="text/javascript"></script>

<script src="/js/script.js" type="text/javascript"></script>


  </div>
</body>
</html>
