<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Category: sql | BobbyTang Tech Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="BobbyTang Tech Blog">
<meta property="og:url" content="http://sicongtang.github.io/categories/sql/">
<meta property="og:site_name" content="BobbyTang Tech Blog">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="BobbyTang Tech Blog">
<meta name="twitter:description">

  
    <link rel="alternative" href="/atom.xml" title="BobbyTang Tech Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">

  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">BobbyTang Tech Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Learn Share Inspire</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="submit" value="&#xF002;" class="search-form-submit"><input type="hidden" name="q" value="site:http://sicongtang.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-2014-09-02-mongodb-sql-summary" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/09/02/2014-09-02-mongodb-sql-summary/" class="article-date">
  <time datetime="2014-09-02T05:41:21.000Z" itemprop="datePublished">Sep 2 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/sql/">sql</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/09/02/2014-09-02-mongodb-sql-summary/">mongodb sql summary</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">w, {Number/String, &gt; -<span class="number">1</span> || ‘majority’ || tag <span class="property">name</span>} <span class="keyword">the</span> <span class="command">write</span> concern <span class="keyword">for</span> <span class="keyword">the</span> operation <span class="keyword">where</span> &lt; <span class="number">1</span> <span class="keyword">is</span> no acknowlegement <span class="keyword">of</span> <span class="command">write</span> <span class="keyword">and</span> w &gt;= <span class="number">1</span>, w = ‘majority’ <span class="keyword">or</span> tag acknowledges <span class="keyword">the</span> <span class="command">write</span></div><div class="line">j, (Boolean, default:<span class="constant">false</span>) <span class="command">write</span> waits <span class="keyword">for</span> journal sync <span class="keyword">before</span> <span class="keyword">returning</span></div></pre></td></tr></table></figure>

<h2 id="system_admin">system admin</h2>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">db.serverStatus()</div><div class="line">db.serverStatus().connections</div></pre></td></tr></table></figure><br>##insert<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">db.foo.insert({<span class="string">"bar"</span> : <span class="string">"baz"</span>})</div><div class="line">db.foo.batchInsert([{<span class="string">"_id"</span> : <span class="number">0</span>}, {<span class="string">"_id"</span> : <span class="number">1</span>}, {<span class="string">"_id"</span> : <span class="number">2</span>}])</div><div class="line"><span class="comment">//One of the basic structure checks is size: all documents must be smaller than 16 MB.</span></div><div class="line"><span class="built_in">Object</span>.bsonsize(doc)</div></pre></td></tr></table></figure>

<h2 id="delete">delete</h2>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">//like detele from, high time cost</span></div><div class="line">db.foo.remove({})</div><div class="line">db.users.remove({status: <span class="string">"D"</span>})</div><div class="line"><span class="comment">//like truncate</span></div><div class="line">db.tester.drop()</div></pre></td></tr></table></figure>

<h2 id="update">update</h2>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">db.people.update({<span class="string">"_id"</span> : ObjectId(<span class="string">"4b2b9f67a1f631733d917a7c"</span>)}, joe)</div><div class="line"></div><div class="line">db.users.update({<span class="string">"name"</span> : <span class="string">"joe"</span>}, {<span class="string">"$set"</span> : {<span class="string">"favorite book"</span> : [<span class="string">"Cat's Cradle"</span>, <span class="string">"Foundation Trilogy"</span>, <span class="string">"Ender's Game"</span>]}})</div><div class="line">db.blog.posts.update({<span class="string">"author.name"</span> : <span class="string">"joe"</span>}, {<span class="string">"$set"</span> : {<span class="string">"author.name"</span> : <span class="string">"joe schmoe"</span>}})</div><div class="line">db.users.update({<span class="string">"name"</span> : <span class="string">"joe"</span>}, {<span class="string">"$unset"</span> : {<span class="string">"favorite book"</span> : <span class="number">1</span>}})</div><div class="line"></div><div class="line"></div><div class="line">db.blog.update({<span class="string">"post"</span> : post_id}, {<span class="string">"$inc"</span> : {<span class="string">"comments.0.votes"</span> : <span class="number">1</span>}})</div><div class="line">db.blog.update({<span class="string">"comments.author"</span> : <span class="string">"John"</span>}, {<span class="string">"$set"</span> : {<span class="string">"comments.$.author"</span> : <span class="string">"Jim"</span>}})</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//full-document replacement, replacing the matched document with {"foo" : "bar"} </span></div><div class="line">db.coll.update(criteria, {<span class="string">"foo"</span> : <span class="string">"bar"</span>})</div><div class="line"></div><div class="line">db.users.update({<span class="string">"_id"</span> : ObjectId(<span class="string">"4b2d75476cc613d5ee930164"</span>)},</div><div class="line">                      {<span class="string">"$addToSet"</span> : {<span class="string">"emails"</span> : {<span class="string">"$each"</span> : [<span class="string">"joe@php.net"</span>, <span class="string">"joe@example.com"</span>, <span class="string">"joe@python.org"</span>]}}})</div><div class="line"></div><div class="line">db.movies.find({<span class="string">"genre"</span> : <span class="string">"horror"</span>}, </div><div class="line">     {<span class="string">"$push"</span> : {<span class="string">"top10"</span> : {</div><div class="line">          <span class="string">"$each"</span> : [{<span class="string">"name"</span> : <span class="string">"Nightmare on Elm Street"</span>, <span class="string">"rating"</span> : <span class="number">6.6</span>}, {<span class="string">"name"</span> : <span class="string">"Saw"</span>, <span class="string">"rating"</span> : <span class="number">4.3</span>}],</div><div class="line">          <span class="string">"$slice"</span> : -<span class="number">10</span>,</div><div class="line">          <span class="string">"$sort"</span> : {<span class="string">"rating"</span> : -<span class="number">1</span>}}}})</div><div class="line"></div><div class="line">{<span class="string">"$pop"</span>: {<span class="string">"key"</span>: <span class="number">1</span>}}</div><div class="line">{<span class="string">"$pop"</span>: {<span class="string">"key"</span>: -<span class="number">1</span>}}</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//remove all the matching documents</span></div><div class="line">db.lists.update({}, {<span class="string">"$pull"</span> : {<span class="string">"todo"</span> : <span class="string">"laundry"</span>}})</div><div class="line"></div><div class="line"><span class="comment">//positional array modification</span></div><div class="line">db.blog.update({<span class="string">"post"</span> : post_id}, {<span class="string">"$inc"</span> : {<span class="string">"comments.0.votes"</span> : <span class="number">1</span>}})</div><div class="line">db.blog.update({<span class="string">"comments.author"</span> : <span class="string">"John"</span>}, {<span class="string">"$set"</span> : {<span class="string">"comments.$.author"</span> : <span class="string">"Jim"</span>}})</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//upserts</span></div><div class="line"><span class="comment">//eliminate the race condition and faster and atomic</span></div><div class="line"></div><div class="line"><span class="comment">//If no document is found that matches the update criteria, a new document will be created by combining the criteria and updated documents.</span></div><div class="line">db.analytics.update({<span class="string">"url"</span> : <span class="string">"/blog"</span>}, {<span class="string">"$inc"</span> : {<span class="string">"pageviews"</span> : <span class="number">1</span>}}, <span class="literal">true</span>)</div><div class="line"><span class="comment">//If we run this update again, it will match the existing document, nothing will be inserted, and so the "createdAt" field will not be changed.</span></div><div class="line">db.users.update({}, {<span class="string">"$setOnInsert"</span> : {<span class="string">"createdAt"</span> : <span class="keyword">new</span> <span class="built_in">Date</span>()}}, <span class="literal">true</span>)</div><div class="line">db.foo.save(x)</div><div class="line">db.foo.update({<span class="string">"_id"</span>: x._id}, x)</div><div class="line"></div><div class="line"><span class="comment">//updating multiple documents</span></div><div class="line"></div><div class="line">db.count.update({x : <span class="number">1</span>}, {$inc : {x : <span class="number">1</span>}}, <span class="literal">false</span>, <span class="literal">true</span>) </div><div class="line">db.runCommand({getLastError : <span class="number">1</span>})</div><div class="line">{</div><div class="line"><span class="string">"err"</span> : <span class="literal">null</span>,</div><div class="line"><span class="string">"updatedExisting"</span> : <span class="literal">true</span>, </div><div class="line"><span class="string">"n"</span> : <span class="number">5</span>,</div><div class="line"><span class="string">"ok"</span> : <span class="literal">true</span></div><div class="line">}</div></pre></td></tr></table></figure>

<h2 id="select">select</h2>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">//</span></div><div class="line">db.users.find()</div><div class="line"><span class="comment">//only display cols</span></div><div class="line">db.users.find({}, {<span class="string">"username"</span> : <span class="number">1</span>)</div><div class="line"><span class="comment">//only display cols without _id</span></div><div class="line">db.users.find({}, {<span class="string">"username"</span> : <span class="number">1</span>, <span class="string">"_id"</span> : <span class="number">0</span>})</div><div class="line"></div><div class="line"><span class="comment">//count</span></div><div class="line">db.users.count()</div><div class="line"></div><div class="line"><span class="comment">//conditionals are an inner document key, and modifiers are always a key in the outer document.</span></div><div class="line"><span class="comment">//There are a few “meta-operators” that go in the outer document: "$and“, "$or“, and "$not“.</span></div><div class="line">db.users.find({<span class="string">"id_num"</span> : {<span class="string">"$not"</span> : {<span class="string">"$mod"</span> : [<span class="number">5</span>, <span class="number">1</span>]}}})</div><div class="line"></div><div class="line">db.users.find({<span class="string">"x"</span> : {<span class="string">"$lt"</span> : <span class="number">1</span>, <span class="string">"$in"</span> : [<span class="number">4</span>]}})</div><div class="line"></div><div class="line"><span class="comment">// will return all the docs</span></div><div class="line">db.c.find({<span class="string">"z"</span>:<span class="literal">null</span>})</div><div class="line"><span class="comment">// only display null value, please use this</span></div><div class="line">db.c.find({<span class="string">"z"</span> : {<span class="string">"$in"</span> : [<span class="literal">null</span>], <span class="string">"$exists"</span> : <span class="literal">true</span>}})</div><div class="line"></div><div class="line"><span class="comment">//indexes cannot be used for case-insensitive searches</span></div><div class="line">db.users.find({<span class="string">"name"</span> : <span class="regexp">/joe/i</span>})</div><div class="line">db.users.find({<span class="string">"name"</span> : <span class="regexp">/joey?/i</span>})</div><div class="line"></div><div class="line"><span class="comment">//querying array</span></div><div class="line">db.food.find({fruit : {$all : [<span class="string">"apple"</span>, <span class="string">"banana"</span>]}})</div><div class="line">db.food.find({<span class="string">"fruit"</span> : {<span class="string">"$size"</span> : <span class="number">3</span>}})</div><div class="line">db.blog.posts.findOne(criteria, {<span class="string">"comments"</span> : {<span class="string">"$slice"</span> : [<span class="number">23</span>, <span class="number">10</span>]}})</div><div class="line">db.blog.posts.find({<span class="string">"comments.name"</span> : <span class="string">"bob"</span>}, {<span class="string">"comments.$"</span> : <span class="number">1</span>})</div><div class="line"></div><div class="line"><span class="comment">//$where</span></div><div class="line"></div><div class="line"><span class="comment">//pagination</span></div><div class="line">db.stock.find({<span class="string">"desc"</span> : <span class="string">"mp3"</span>}).limit(<span class="number">50</span>).skip(<span class="number">50</span>).sort({<span class="string">"price"</span> : -<span class="number">1</span>})</div><div class="line"></div><div class="line"><span class="comment">//find a random document</span></div><div class="line"><span class="keyword">var</span> random = <span class="built_in">Math</span>.random()</div><div class="line">result = db.foo.findOne({<span class="string">"random"</span> : {<span class="string">"$gt"</span> : random}}) </div><div class="line"><span class="keyword">if</span> (result == <span class="literal">null</span>) {</div><div class="line">  result = db.foo.findOne({<span class="string">"random"</span> : {<span class="string">"$lt"</span> : random}}) </div><div class="line">} </div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//cursor</span></div><div class="line">cursor = db.foo.find();</div><div class="line"><span class="keyword">while</span> (cursor.hasNext()) {</div><div class="line">  <span class="keyword">var</span> doc = cursor.next();</div><div class="line">  doc = process(doc);</div><div class="line">  db.foo.save(doc);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//command</span></div><div class="line">use temp</div><div class="line">db.runCommand({shutdown:<span class="number">1</span>})</div><div class="line">db.adminCommand({<span class="string">"shutdown"</span> : <span class="number">1</span>}) </div></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://sicongtang.github.io/2014/09/02/2014-09-02-mongodb-sql-summary/" data-id="dbvbpedqxhazg6qy" class="article-share-link">Share</a>
      
        <a href="http://sicongtang.github.io/2014/09/02/2014-09-02-mongodb-sql-summary/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2014-03-10-sql-sybasease-alternative-way-to-support-lead-slash-lag-function" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/03/10/2014-03-10-sql-sybasease-alternative-way-to-support-lead-slash-lag-function/" class="article-date">
  <time datetime="2014-03-09T17:32:05.000Z" itemprop="datePublished">Mar 10 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/sql/">sql</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/03/10/2014-03-10-sql-sybasease-alternative-way-to-support-lead-slash-lag-function/">SQL - SybaseASE - Alternative way to support LEAD/LAG function</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>There is audit trial requirement that need to be captured into log table these day. But we suffer from the limited function provided by Sybase ASE DB in order to achieve our goals. SybaseASE 12.5 does not support neither analytic function nor row number column, and therefore we have to implement cross comparison by ourselves via basic semantics.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">--create rownum column</span></div><div class="line"><span class="operator"><span class="keyword">select</span> rownum = <span class="keyword">identity</span>(<span class="number">10</span>), * <span class="keyword">from</span> #temp_table <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">where</span> <span class="number">1</span>=<span class="number">2</span></span></div><div class="line"></div><div class="line"><span class="keyword">insert</span> <span class="keyword">into</span> #temp_table</div><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">where</span> pid = @pid</div><div class="line"><span class="keyword">insert</span> <span class="keyword">into</span> #temp_table</div><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> table_history <span class="keyword">where</span> pid = @pid <span class="keyword">order</span> <span class="keyword">by</span> audit_update_date <span class="keyword">desc</span></div><div class="line"></div><div class="line"><span class="comment">--use self-join to match the cross rows</span></div><div class="line"><span class="keyword">select</span> a.rownum,</div><div class="line">		<span class="keyword">case</span> <span class="keyword">when</span> a.col1 = b.col1 <span class="keyword">then</span> <span class="string">'equal'</span> <span class="keyword">else</span> <span class="string">'inequal'</span> <span class="keyword">end</span></div><div class="line"><span class="keyword">from</span> #temp_table a <span class="keyword">left</span> out <span class="keyword">join</span> #temp_table b <span class="keyword">on</span> ( a.pid = b.pid <span class="keyword">and</span> (a.rownum + <span class="number">1</span>) = b.rownum )</div><div class="line"><span class="keyword">where</span> ...</div></pre></td></tr></table></figure>

<p>In contrast, we also provide oracle version of implementation.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://sicongtang.github.io/2014/03/10/2014-03-10-sql-sybasease-alternative-way-to-support-lead-slash-lag-function/" data-id="b1r2diiqavv3oi2o" class="article-share-link">Share</a>
      
        <a href="http://sicongtang.github.io/2014/03/10/2014-03-10-sql-sybasease-alternative-way-to-support-lead-slash-lag-function/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2014-03-10-sql-switch-slash-transpose-columns-and-rows" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/03/10/2014-03-10-sql-switch-slash-transpose-columns-and-rows/" class="article-date">
  <time datetime="2014-03-09T16:28:27.000Z" itemprop="datePublished">Mar 10 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/sql/">sql</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/03/10/2014-03-10-sql-switch-slash-transpose-columns-and-rows/">SQL - Switch/Transpose columns and rows</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>In practice, we will meet the requirement to rotate the table including convert cols to rows, convert rows to cols. In this session, I’ll produce the solution in common method as well as db-specified features.</p>
<h2 id="Convert_columns_to_rows">Convert columns to rows</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">--common solution</span></div><div class="line"><span class="operator"><span class="keyword">select</span> * <span class="keyword">from</span> (</span></div><div class="line">	<span class="keyword">select</span> id, <span class="string">'col_1'</span> <span class="keyword">as</span> col_name, col_1 <span class="keyword">as</span> col_val</div><div class="line">	<span class="keyword">from</span> <span class="keyword">table</span></div><div class="line">	<span class="keyword">union</span> <span class="keyword">all</span></div><div class="line">	<span class="keyword">select</span> id, <span class="string">'col_2'</span> <span class="keyword">as</span> col_name, col_2 <span class="keyword">as</span> col_val</div><div class="line">	<span class="keyword">from</span> <span class="keyword">table</span></div><div class="line">	<span class="keyword">union</span> <span class="keyword">all</span></div><div class="line">	... </div><div class="line">) <span class="keyword">order</span> <span class="keyword">by</span> id</div></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">--oracle 11g unpivot query</span></div><div class="line"><span class="operator"><span class="keyword">select</span> *</span></div><div class="line"><span class="keyword">from</span> <span class="keyword">table</span></div><div class="line">unpivot (</div><div class="line">	col_val <span class="keyword">for</span> col_name <span class="keyword">in</span> (col_1 <span class="keyword">as</span> <span class="string">'col_1'</span>, col_2 <span class="keyword">as</span> <span class="string">'col_2'</span>)</div><div class="line">)</div><div class="line"><span class="keyword">order</span> <span class="keyword">by</span> id</div></pre></td></tr></table></figure>

<h2 id="Concert_rows_to_columns">Concert rows to columns</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">--common solution</span></div><div class="line"><span class="operator"><span class="keyword">select</span> id,</span></div><div class="line">	<span class="keyword">max</span>(<span class="keyword">case</span> <span class="keyword">when</span> col_name = <span class="string">'col_1'</span> <span class="keyword">then</span> col_val <span class="keyword">else</span> <span class="literal">null</span> <span class="keyword">end</span>) <span class="keyword">as</span> col_1,</div><div class="line">	<span class="keyword">max</span>(<span class="keyword">case</span> <span class="keyword">when</span> col_name = <span class="string">'col_2'</span> <span class="keyword">then</span> col_val <span class="keyword">else</span> <span class="literal">null</span> <span class="keyword">end</span>) <span class="keyword">as</span> col_2,</div><div class="line">	...</div><div class="line"><span class="keyword">from</span> <span class="keyword">table</span></div><div class="line"><span class="keyword">order</span> <span class="keyword">by</span> id</div></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">--oracle 11g pivot query</span></div><div class="line"><span class="operator"><span class="keyword">select</span> *</span></div><div class="line"><span class="keyword">from</span> <span class="keyword">table</span></div><div class="line">pivot (</div><div class="line">	<span class="keyword">max</span>(col_val) <span class="keyword">for</span> col_name <span class="keyword">in</span> (<span class="string">'col_1'</span> <span class="keyword">as</span> col_1,<span class="string">'col_2'</span> <span class="keyword">as</span> col_2)</div><div class="line">)</div><div class="line"><span class="keyword">where</span> ...</div><div class="line"><span class="keyword">order</span> <span class="keyword">by</span> id</div></pre></td></tr></table></figure>

<h2 id="Excel_pivot_table">Excel pivot table</h2>
<p>For non-sql approaches, we can use excel pivot table. Excel spreadsheets are a great way to pivot and analyze Oracle data, and tools.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://sicongtang.github.io/2014/03/10/2014-03-10-sql-switch-slash-transpose-columns-and-rows/" data-id="1rsvl60hiaq8468j" class="article-share-link">Share</a>
      
        <a href="http://sicongtang.github.io/2014/03/10/2014-03-10-sql-switch-slash-transpose-columns-and-rows/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
  
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/books/">books</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/devenvsetup-emacs/">devenvsetup emacs</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/devenvsetup-python/">devenvsetup python</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/devenvsetup-ruby/">devenvsetup ruby</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/javascript/">javascript</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/sql/">sql</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/test/">test</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/05/">May 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">April 2014</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/03/">March 2014</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/01/">January 2014</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2014/10/02/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2014/09/05/2014-09-05-javascript-patterns-notes/">Javascript Patterns Notes</a>
          </li>
        
          <li>
            <a href="/2014/09/02/2014-09-02-mongodb-sql-summary/">mongodb sql summary</a>
          </li>
        
          <li>
            <a href="/2014/07/24/2014-07-24-a-series-of-general-questions-while-designing-webapps/">A series of general questions while designing webapps</a>
          </li>
        
          <li>
            <a href="/2014/07/23/2014-07-23-getting-start-with-emacs/">Getting Start with Emacs</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2014 Bobby Tang<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'bobbytang';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">

  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>



<script src="/js/script.js" type="text/javascript"></script>


  </div>
</body>
</html>